<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='æœ¬æ–‡ç¿»è¯‘è‡ª https://github.com/evrone/go-clean-templateï¼Œç”±äºæœ¬äººç¿»è¯‘æ°´å¹³æœ‰é™ï¼Œç¿»è¯‘ä¸å½“ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚
Go æ•´æ´æ¶æ„æ¨¡æ¿ã€‚ æ¦‚æ‹¬ æ¨¡æ¿çš„ä½œç”¨ :
å¦‚ä½•ç»„ç»‡é¡¹ç›®å¹¶é˜²æ­¢å®ƒå˜æˆä¸€å¨æ„å¤§åˆ©é¢æ¡å¼çš„ä»£ç ã€‚ åœ¨å“ªé‡Œå­˜æ”¾ä¸šåŠ¡é€»è¾‘ï¼Œä½¿å…¶ä¿æŒç‹¬ç«‹ï¼Œæ•´æ´å’Œå¯æ‰©å±•ã€‚ å¦‚ä½•åœ¨å¾®æœåŠ¡æ‰©å±•æ—¶ä¸å¤±æ§ æ¨¡ç‰ˆä½¿ç”¨äº† Robert Martin ( ä¹Ÿå« Bob å”å” ) çš„åŸåˆ™ã€‚
Go-clean-template æ­¤ä»“åº“ç”± Evrone åˆ›å»ºåŠç»´æŠ¤ã€‚
ç›®å½•å†…å®¹ å¿«é€Ÿå¼€å§‹ é¡¹ç›®ç»“æ„ ä¾èµ–æ³¨å…¥ æ•´æ´æ¶æ„ä¹‹é“ å¿«é€Ÿå¼€å§‹ æœ¬åœ°å¼€å‘
1 2 3 4 # Postgres, RabbitMQ $ make compose-up # Run app with migrations $ make run é›†æˆæµ‹è¯• ( å¯ä»¥åœ¨ CI ä¸­è¿è¡Œ )
1 2 # DB, app &#43; migrations, integration tests $ make compose-up-integration-test é¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 â”œâ”€â”€ cmd â”‚ â””â”€â”€ app â”‚ â””â”€â”€ main.'>
<title>go clean template</title>

<link rel='canonical' href='https://blog.golang.space/p/go-clean-template/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='go clean template'>
<meta property='og:description' content='æœ¬æ–‡ç¿»è¯‘è‡ª https://github.com/evrone/go-clean-templateï¼Œç”±äºæœ¬äººç¿»è¯‘æ°´å¹³æœ‰é™ï¼Œç¿»è¯‘ä¸å½“ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚
Go æ•´æ´æ¶æ„æ¨¡æ¿ã€‚ æ¦‚æ‹¬ æ¨¡æ¿çš„ä½œç”¨ :
å¦‚ä½•ç»„ç»‡é¡¹ç›®å¹¶é˜²æ­¢å®ƒå˜æˆä¸€å¨æ„å¤§åˆ©é¢æ¡å¼çš„ä»£ç ã€‚ åœ¨å“ªé‡Œå­˜æ”¾ä¸šåŠ¡é€»è¾‘ï¼Œä½¿å…¶ä¿æŒç‹¬ç«‹ï¼Œæ•´æ´å’Œå¯æ‰©å±•ã€‚ å¦‚ä½•åœ¨å¾®æœåŠ¡æ‰©å±•æ—¶ä¸å¤±æ§ æ¨¡ç‰ˆä½¿ç”¨äº† Robert Martin ( ä¹Ÿå« Bob å”å” ) çš„åŸåˆ™ã€‚
Go-clean-template æ­¤ä»“åº“ç”± Evrone åˆ›å»ºåŠç»´æŠ¤ã€‚
ç›®å½•å†…å®¹ å¿«é€Ÿå¼€å§‹ é¡¹ç›®ç»“æ„ ä¾èµ–æ³¨å…¥ æ•´æ´æ¶æ„ä¹‹é“ å¿«é€Ÿå¼€å§‹ æœ¬åœ°å¼€å‘
1 2 3 4 # Postgres, RabbitMQ $ make compose-up # Run app with migrations $ make run é›†æˆæµ‹è¯• ( å¯ä»¥åœ¨ CI ä¸­è¿è¡Œ )
1 2 # DB, app &#43; migrations, integration tests $ make compose-up-integration-test é¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 â”œâ”€â”€ cmd â”‚ â””â”€â”€ app â”‚ â””â”€â”€ main.'>
<meta property='og:url' content='https://blog.golang.space/p/go-clean-template/'>
<meta property='og:site_name' content='ixugo'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2021-02-01T12:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-02-01T12:00:00&#43;00:00'/><meta property='og:image' content='http://img.golang.space/shot-1629111300629.svg' />
<meta name="twitter:title" content="go clean template">
<meta name="twitter:description" content="æœ¬æ–‡ç¿»è¯‘è‡ª https://github.com/evrone/go-clean-templateï¼Œç”±äºæœ¬äººç¿»è¯‘æ°´å¹³æœ‰é™ï¼Œç¿»è¯‘ä¸å½“ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚
Go æ•´æ´æ¶æ„æ¨¡æ¿ã€‚ æ¦‚æ‹¬ æ¨¡æ¿çš„ä½œç”¨ :
å¦‚ä½•ç»„ç»‡é¡¹ç›®å¹¶é˜²æ­¢å®ƒå˜æˆä¸€å¨æ„å¤§åˆ©é¢æ¡å¼çš„ä»£ç ã€‚ åœ¨å“ªé‡Œå­˜æ”¾ä¸šåŠ¡é€»è¾‘ï¼Œä½¿å…¶ä¿æŒç‹¬ç«‹ï¼Œæ•´æ´å’Œå¯æ‰©å±•ã€‚ å¦‚ä½•åœ¨å¾®æœåŠ¡æ‰©å±•æ—¶ä¸å¤±æ§ æ¨¡ç‰ˆä½¿ç”¨äº† Robert Martin ( ä¹Ÿå« Bob å”å” ) çš„åŸåˆ™ã€‚
Go-clean-template æ­¤ä»“åº“ç”± Evrone åˆ›å»ºåŠç»´æŠ¤ã€‚
ç›®å½•å†…å®¹ å¿«é€Ÿå¼€å§‹ é¡¹ç›®ç»“æ„ ä¾èµ–æ³¨å…¥ æ•´æ´æ¶æ„ä¹‹é“ å¿«é€Ÿå¼€å§‹ æœ¬åœ°å¼€å‘
1 2 3 4 # Postgres, RabbitMQ $ make compose-up # Run app with migrations $ make run é›†æˆæµ‹è¯• ( å¯ä»¥åœ¨ CI ä¸­è¿è¡Œ )
1 2 # DB, app &#43; migrations, integration tests $ make compose-up-integration-test é¡¹ç›®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 â”œâ”€â”€ cmd â”‚ â””â”€â”€ app â”‚ â””â”€â”€ main."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://img.golang.space/shot-1629111300629.svg' />
    <link rel="shortcut icon" href="img/favicon.ico" />

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-192125643-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu0b04ba6d7249c9f90c92db974439eb8c_208246_300x0_resize_box_3.png" width="300"
                            height="321" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ§</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ixugo</a></h1>
            <h2 class="site-description">èµ°å‡ºèˆ’é€‚åŒº</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/ixugo'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#æ¦‚æ‹¬">æ¦‚æ‹¬</a></li>
    <li><a href="#ç›®å½•å†…å®¹">ç›®å½•å†…å®¹</a>
      <ol>
        <li><a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a></li>
      </ol>
    </li>
    <li><a href="#é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</a>
      <ol>
        <li><a href="#cmdappmaingo"><code>cmd/app/main.go</code></a></li>
        <li><a href="#config"><code>config</code></a></li>
        <li><a href="#docs"><code>docs</code></a></li>
        <li><a href="#integration-test"><code>integration-test</code></a></li>
        <li><a href="#internalapp"><code>internal/app</code></a></li>
        <li><a href="#internaldelivery"><code>internal/delivery</code></a>
          <ol>
            <li><a href="#internaldeliveryhttp"><code>internal/delivery/http</code></a></li>
          </ol>
        </li>
        <li><a href="#internaldomain"><code>internal/domain</code></a></li>
        <li><a href="#internalservice"><code>internal/service</code></a>
          <ol>
            <li><a href="#internalservicerepo"><code>internal/service/repo</code></a></li>
            <li><a href="#internalservicewebapi"><code>internal/service/webapi</code></a></li>
          </ol>
        </li>
        <li><a href="#pkgrabbitmq"><code>pkg/rabbitmq</code></a></li>
      </ol>
    </li>
    <li><a href="#ä¾èµ–æ³¨å…¥">ä¾èµ–æ³¨å…¥</a></li>
    <li><a href="#æ•´æ´æ¶æ„ä¹‹é“">æ•´æ´æ¶æ„ä¹‹é“</a>
      <ol>
        <li><a href="#å…³é”®ç‚¹">å…³é”®ç‚¹</a></li>
        <li><a href="#ä¸»è¦åŸåˆ™">ä¸»è¦åŸåˆ™</a></li>
        <li><a href="#å±‚çº§">å±‚çº§</a></li>
        <li><a href="#é™„åŠ å±‚">é™„åŠ å±‚</a></li>
        <li><a href="#æ›¿ä»£æ–¹æ³•">æ›¿ä»£æ–¹æ³•</a></li>
      </ol>
    </li>
    <li><a href="#ç±»ä¼¼çš„é¡¹ç›®">ç±»ä¼¼çš„é¡¹ç›®</a></li>
    <li><a href="#æ‰©å±•é˜…è¯»é“¾æ¥">æ‰©å±•é˜…è¯»é“¾æ¥</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/go-clean-template/">
                
                    <img src="http://img.golang.space/shot-1629111300629.svg" loading="lazy" alt="Featured image of post go clean template" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E8%AF%91%E6%96%87/" >
                è¯‘æ–‡
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/go-clean-template/">go clean template</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 01, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    4 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>æœ¬æ–‡ç¿»è¯‘è‡ª <a class="link" href="https://github.com/evrone/go-clean-template"  target="_blank" rel="noopener"
    >https://github.com/evrone/go-clean-template</a>ï¼Œç”±äºæœ¬äººç¿»è¯‘æ°´å¹³æœ‰é™ï¼Œç¿»è¯‘ä¸å½“ä¹‹å¤„çƒ¦è¯·æŒ‡å‡ºã€‚</p>
<h1 id="go-æ•´æ´æ¶æ„æ¨¡æ¿">Go æ•´æ´æ¶æ„æ¨¡æ¿ã€‚</h1>
<h2 id="æ¦‚æ‹¬">æ¦‚æ‹¬</h2>
<p>æ¨¡æ¿çš„ä½œç”¨ :</p>
<ul>
<li>å¦‚ä½•ç»„ç»‡é¡¹ç›®å¹¶é˜²æ­¢å®ƒå˜æˆä¸€å¨æ„å¤§åˆ©é¢æ¡å¼çš„ä»£ç ã€‚</li>
<li>åœ¨å“ªé‡Œå­˜æ”¾ä¸šåŠ¡é€»è¾‘ï¼Œä½¿å…¶ä¿æŒç‹¬ç«‹ï¼Œæ•´æ´å’Œå¯æ‰©å±•ã€‚</li>
<li>å¦‚ä½•åœ¨å¾®æœåŠ¡æ‰©å±•æ—¶ä¸å¤±æ§</li>
</ul>
<p>æ¨¡ç‰ˆä½¿ç”¨äº† Robert Martin ( ä¹Ÿå« Bob å”å” ) çš„<a class="link" href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"  target="_blank" rel="noopener"
    >åŸåˆ™</a>ã€‚</p>
<p><a class="link" href="https://evrone.com/go-clean-template?utm_source=github&amp;utm_campaign=go-clean-template"  target="_blank" rel="noopener"
    >Go-clean-template</a> æ­¤ä»“åº“ç”± <a class="link" href="https://evrone.com/?utm_source=github&amp;utm_campaign=go-clean-template"  target="_blank" rel="noopener"
    >Evrone</a> åˆ›å»ºåŠç»´æŠ¤ã€‚</p>
<h2 id="ç›®å½•å†…å®¹">ç›®å½•å†…å®¹</h2>
<ul>
<li>å¿«é€Ÿå¼€å§‹</li>
<li>é¡¹ç›®ç»“æ„</li>
<li>ä¾èµ–æ³¨å…¥</li>
<li>æ•´æ´æ¶æ„ä¹‹é“</li>
</ul>
<h3 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h3>
<p>æœ¬åœ°å¼€å‘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Postgres, RabbitMQ</span>
</span></span><span class="line"><span class="cl">$ make compose-up
</span></span><span class="line"><span class="cl"><span class="c1"># Run app with migrations</span>
</span></span><span class="line"><span class="cl">$ make run
</span></span></code></pre></td></tr></table>
</div>
</div><p>é›†æˆæµ‹è¯• ( å¯ä»¥åœ¨ CI ä¸­è¿è¡Œ )</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># DB, app + migrations, integration tests</span>
</span></span><span class="line"><span class="cl">$ make compose-up-integration-test
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">â”œâ”€â”€ cmd
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ app
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ main.go
</span></span><span class="line"><span class="cl">â”œâ”€â”€ config
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ config.go
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ config.yml
</span></span><span class="line"><span class="cl">â”œâ”€â”€ docs
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ docs.go
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ swagger.json
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ swagger.yaml
</span></span><span class="line"><span class="cl">â”œâ”€â”€ go.mod
</span></span><span class="line"><span class="cl">â”œâ”€â”€ go.sum
</span></span><span class="line"><span class="cl">â”œâ”€â”€ integration-test
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ Dockerfile
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ integration_test.go
</span></span><span class="line"><span class="cl">â”œâ”€â”€ internal
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ app
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ app.go
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ migrate.go
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ delivery
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ amqp_rpc
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚   â”œâ”€â”€ router.go
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚   â””â”€â”€ translation.go
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ http
</span></span><span class="line"><span class="cl">â”‚   â”‚       â””â”€â”€ v1
</span></span><span class="line"><span class="cl">â”‚   â”‚           â”œâ”€â”€ error.go
</span></span><span class="line"><span class="cl">â”‚   â”‚           â”œâ”€â”€ router.go
</span></span><span class="line"><span class="cl">â”‚   â”‚           â””â”€â”€ translation.go
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ domain
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ translation.go
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ service
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ interfaces.go
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ repo
</span></span><span class="line"><span class="cl">â”‚       â”‚   â””â”€â”€ translation_postgres.go
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ translation.go
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ webapi
</span></span><span class="line"><span class="cl">â”‚           â””â”€â”€ translation_google.go
</span></span><span class="line"><span class="cl">â”œâ”€â”€ migrations
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ 20210221023242_migrate_name.down.sql
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ 20210221023242_migrate_name.up.sql
</span></span><span class="line"><span class="cl">â””â”€â”€ pkg
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ httpserver
</span></span><span class="line"><span class="cl">    â”‚   â”œâ”€â”€ options.go
</span></span><span class="line"><span class="cl">    â”‚   â””â”€â”€ server.go
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ logger
</span></span><span class="line"><span class="cl">    â”‚   â”œâ”€â”€ interface.go
</span></span><span class="line"><span class="cl">    â”‚   â”œâ”€â”€ logger.go
</span></span><span class="line"><span class="cl">    â”‚   â””â”€â”€ zap.go
</span></span><span class="line"><span class="cl">    â”œâ”€â”€ postgres
</span></span><span class="line"><span class="cl">    â”‚   â”œâ”€â”€ options.go
</span></span><span class="line"><span class="cl">    â”‚   â””â”€â”€ postgres.go
</span></span><span class="line"><span class="cl">    â””â”€â”€ rabbitmq
</span></span><span class="line"><span class="cl">        â””â”€â”€ rmq_rpc
</span></span><span class="line"><span class="cl">            â”œâ”€â”€ client
</span></span><span class="line"><span class="cl">            â”‚   â”œâ”€â”€ client.go
</span></span><span class="line"><span class="cl">            â”‚   â””â”€â”€ options.go
</span></span><span class="line"><span class="cl">            â”œâ”€â”€ connection.go
</span></span><span class="line"><span class="cl">            â”œâ”€â”€ errors.go
</span></span><span class="line"><span class="cl">            â””â”€â”€ server
</span></span><span class="line"><span class="cl">                â”œâ”€â”€ options.go
</span></span><span class="line"><span class="cl">                â””â”€â”€ server.go
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cmdappmaingo"><code>cmd/app/main.go</code></h3>
<p><strong>é…ç½®å’Œæ—¥å¿—å®ä¾‹çš„åˆå§‹åŒ–</strong>ï¼Œ<code>main</code> å‡½æ•°ä¸­è°ƒç”¨<code>internal/app/app.go</code> æ–‡ä»¶ä¸­ çš„ Run å‡½æ•°ï¼Œmain å‡½æ•°å°†ä¼šåœ¨æ­¤ &ldquo;å»¶ç»­&rdquo;ã€‚</p>
<h3 id="config"><code>config</code></h3>
<p><strong>é…ç½®</strong>ã€‚é¦–å…ˆè¯»å– <code>config.yml</code>ï¼Œç„¶åç”¨ç¯å¢ƒå˜é‡è¦†ç›–ç›¸åŒ¹é…çš„ yaml é…ç½®ã€‚é…ç½®çš„ç»“æ„ä½“åœ¨ <code>config.go</code> æ–‡ä»¶ä¸­ã€‚<code>env-required: true</code> ç»“æ„ä½“æ ‡ç­¾å¼ºåˆ¶æ‚¨æŒ‡å®šä¸€ä¸ªå€¼ ( åœ¨ yaml æˆ–åœ¨ç¯å¢ƒå˜é‡ä¸­ )ã€‚</p>
<p>å¯¹äºé…ç½®è¯»å–ï¼Œæˆ‘ä»¬é€‰æ‹© <a class="link" href="https://github.com/ilyakaznacheev/cleanenv"  target="_blank" rel="noopener"
    >cleanenv</a> åº“ã€‚å®ƒåœ¨ GitHub ä¸Šæ²¡æœ‰å¾ˆå¤š starï¼Œä½†å¾ˆç®€å•ä¸”æ»¡è¶³æ‰€æœ‰çš„éœ€æ±‚ã€‚</p>
<p>ä» yaml ä¸­è¯»å–é…ç½®è¿èƒŒäº†12 è¦ç´ ï¼Œä½†åœ¨å®è·µä¸­ï¼Œå®ƒæ¯”ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–æ•´ä¸ªé…ç½®æ›´æ–¹ä¾¿ã€‚å‡è®¾é»˜è®¤å€¼å®šä¹‰åœ¨ yaml ä¸­ï¼Œæ•æ„Ÿçš„å˜é‡å®šä¹‰åœ¨ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<h3 id="docs"><code>docs</code></h3>
<p><strong>Swagger æ–‡æ¡£</strong>ã€‚å¯ä»¥ç”± <a class="link" href="https://github.com/swaggo/swag"  target="_blank" rel="noopener"
    >swag</a> åº“è‡ªåŠ¨ç”Ÿæˆã€‚è€Œä½ ä¸éœ€è¦è‡ªå·±æ”¹æ­£ä»»ä½•äº‹æƒ…ã€‚</p>
<h3 id="integration-test"><code>integration-test</code></h3>
<p><strong>é›†æˆæµ‹è¯•</strong>ã€‚å®ƒä»¬ä½œä¸ºå•ç‹¬çš„å®¹å™¨å¯åŠ¨ï¼Œç´§æŒ¨ç€åº”ç”¨ç¨‹åºå®¹å™¨ã€‚ä½¿ç”¨ <a class="link" href="https://github.com/Eun/go-hit"  target="_blank" rel="noopener"
    >go-hit</a> æµ‹è¯• REST API éå¸¸æ–¹ä¾¿ã€‚</p>
<h3 id="internalapp"><code>internal/app</code></h3>
<p>åœ¨ <code>app.go</code> æ–‡ä»¶ä¸­ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ª Run å‡½æ•°ï¼Œå®ƒâ€œå»¶ç»­â€äº†mainå‡½æ•°ã€‚</p>
<p>è¿™æ˜¯åˆ›å»ºæ‰€æœ‰ä¸»è¦å¯¹è±¡çš„åœ°æ–¹ã€‚ä¾èµ–æ³¨å…¥é€šè¿‡â€œ New&hellip;â€æ„é€ å‡½æ•° ( å‚è§ä¾èµ–æ³¨å…¥ ) ã€‚è¿™ç§æŠ€æœ¯å…è®¸æˆ‘ä»¬ä½¿ç”¨ä¾èµ–æ³¨å…¥åŸåˆ™å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œåˆ†å±‚ï¼Œä½¿å¾—ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹äºå…¶ä»–å±‚ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä¸ºäº†ä¼˜é›…çš„å®Œæˆï¼Œæˆ‘ä»¬å¯åŠ¨æœåŠ¡å¹¶åœ¨selectä¸­ç­‰å¾…ç‰¹å®šçš„ä¿¡å·ã€‚å¦‚æœ <code>app.go</code> ä»£ç è¶Šæ¥è¶Šå¤šï¼Œå¯ä»¥å°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ã€‚</p>
<p>å¯¹äºå¤§é‡çš„æ³¨å…¥ï¼Œå¯ä»¥ä½¿ç”¨ <a class="link" href="https://github.com/google/wire"  target="_blank" rel="noopener"
    >wire</a> åº“ ( wire æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå·¥å…·ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥è‡ªåŠ¨è¿æ¥ç»„ä»¶)ã€‚</p>
<p><code>migrate.go</code> æ–‡ä»¶ç”¨äºæ•°æ®åº“è‡ªåŠ¨è¿ç§»ã€‚å¦‚æœæŒ‡å®šäº† migrate æ ‡ç­¾çš„å‚æ•°ï¼Œåˆ™ä¼šåŒ…å«å®ƒã€‚ä¾‹å¦‚ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ go run -tags migrate ./cmd/app
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="internaldelivery"><code>internal/delivery</code></h3>
<p><strong>æœåŠ¡çš„handlerå±‚</strong> ( MVC æ§åˆ¶å™¨ )ã€‚æ¨¡æ¿å±•ç¤ºäº†ä¸¤ä¸ªæœåŠ¡:</p>
<ul>
<li>RPC (  RabbitMQ ç”¨äºä¼ é€’æ¶ˆæ¯ )</li>
<li>REST HTTP ( GIN æ¡†æ¶ )</li>
</ul>
<p>æœåŠ¡çš„è·¯ç”±ä¹Ÿä»¥åŒæ ·çš„é£æ ¼ç¼–å†™ :</p>
<ul>
<li>HandlersæŒ‰ç…§åº”ç”¨é¢†åŸŸåˆ†ç»„ ( æŒ‰å…¬å…±åŸºç¡€ )</li>
<li>å¯¹äºæ¯ä¸ªç»„ï¼Œéƒ½åˆ›å»ºè‡ªå·±çš„è·¯ç”±ç»“æ„ï¼Œä»¥åŠå¤„ç†æ¥å£è·¯å¾„çš„æ–¹æ³•</li>
<li>ä¸šåŠ¡é€»è¾‘çš„ç»“æ„è¢«æ³¨å…¥åˆ°è·¯ç”±ç»“æ„ä¸­ï¼Œç”±handlerså¤„ç†è°ƒç”¨</li>
</ul>
<h4 id="internaldeliveryhttp"><code>internal/delivery/http</code></h4>
<p><strong>ç®€å•çš„ REST ç‰ˆæœ¬æ§åˆ¶</strong>ã€‚å¯¹äº v2ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å…·æœ‰ç›¸åŒå†…å®¹çš„ <code>http/v2</code> æ–‡ä»¶å¤¹ã€‚åœ¨ <code>internal/app</code> ç¨‹åºæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">handler</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">v1</span><span class="p">.</span><span class="nf">NewRouter</span><span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="nx">translationService</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">v2</span><span class="p">.</span><span class="nf">NewRouter</span><span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="nx">translationService</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–çš„ HTTP æ¡†æ¶ç”šè‡³æ˜¯æ ‡å‡†çš„ net/http åº“æ¥ä»£æ›¿ Ginã€‚</p>
<p>åœ¨ <code>v1/router.go</code> å’Œä¸Šé¢çš„ handler æ–¹æ³•ä¸­ï¼Œæœ‰ä¸€äº›æ³¨é‡Šæ˜¯ç”¨ swagåº“æ¥ç”Ÿæˆ swagger æ–‡æ¡£çš„ã€‚</p>
<h3 id="internaldomain"><code>internal/domain</code></h3>
<p><strong>ä¸šåŠ¡é€»è¾‘çš„å®ä½“</strong> ( æ¨¡å‹ ) å¯ä»¥åœ¨ä»»ä½•å±‚ä¸­ä½¿ç”¨ã€‚ä¹Ÿå¯ä»¥æœ‰æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œç”¨äºéªŒè¯ã€‚</p>
<h3 id="internalservice"><code>internal/service</code></h3>
<p><strong>ä¸šåŠ¡é€»è¾‘</strong></p>
<ul>
<li>æ–¹æ³•æŒ‰åº”ç”¨é¢†åŸŸåˆ†ç»„ ( åœ¨å…¬å…±çš„åŸºç¡€ä¸Š )</li>
<li>æ¯ä¸ªç»„éƒ½æœ‰è‡ªå·±çš„ç»“æ„</li>
<li>ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªç»“æ„</li>
</ul>
<p>Repositoriesã€ webapiã€ rpc å’Œå…¶ä»–ä¸šåŠ¡é€»è¾‘ç»“æ„è¢«æ³¨å…¥åˆ°ä¸šåŠ¡é€»è¾‘ç»“æ„ä¸­ ( è§ä¾èµ–æ³¨å…¥ )ã€‚</p>
<h4 id="internalservicerepo"><code>internal/service/repo</code></h4>
<p>repository æ˜¯ä¸šåŠ¡é€»è¾‘ä½¿ç”¨çš„<strong>æŠ½è±¡å­˜å‚¨</strong> ( æ•°æ®åº“ )ã€‚</p>
<h4 id="internalservicewebapi"><code>internal/service/webapi</code></h4>
<p>å®ƒæ˜¯ä¸šåŠ¡é€»è¾‘ä½¿ç”¨çš„<strong>æŠ½è±¡ web API</strong>ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½æ˜¯ä¸šåŠ¡é€»è¾‘é€šè¿‡ REST API è®¿é—®çš„å¦ä¸€ä¸ªå¾®æœåŠ¡ã€‚åŒ…çš„åç§°æ ¹æ®ç”¨é€”è€Œå˜åŒ–ã€‚</p>
<h3 id="pkgrabbitmq"><code>pkg/rabbitmq</code></h3>
<p>RabbitMQ RPC æ¨¡å¼ :</p>
<ul>
<li>RabbitMQ å†…éƒ¨æ²¡æœ‰è·¯ç”±</li>
<li>ä½¿ç”¨Exchange fanout å¹¿æ’­æ¨¡å¼ï¼Œå°†1 ä¸ªç‹¬ç«‹é˜Ÿåˆ—ç»‘å®šåˆ°å…¶ä¸­ï¼Œè¿™æ˜¯æœ€é«˜æ•ˆçš„é…ç½®ã€‚</li>
<li>é‡æ–°è¿æ¥æ–­å¼€ä¸¢å¤±çš„è¿æ¥</li>
</ul>
<h2 id="ä¾èµ–æ³¨å…¥">ä¾èµ–æ³¨å…¥</h2>
<p>ä¸ºäº†æ¶ˆé™¤ä¸šåŠ¡é€»è¾‘å¯¹å¤–éƒ¨åŒ…çš„ä¾èµ–ï¼Œä½¿ç”¨äº†ä¾èµ–æ³¨å…¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œé€šè¿‡ NewService æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å°†ä¾èµ–æ³¨å…¥åˆ°ä¸šåŠ¡é€»è¾‘çš„ç»“æ„ä¸­ã€‚è¿™ä½¿å¾—ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹ ( ä¾¿äºç§»æ¤ )ã€‚æˆ‘ä»¬å¯ä»¥é‡å†™æ¥å£çš„å®ç°ï¼Œè€Œä¸éœ€è¦å¯¹ <code>service</code> åŒ…è¿›è¡Œæ›´æ”¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">service</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Nothing!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Repository</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Service</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">repo</span> <span class="nx">Repository</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewService</span><span class="p">(</span><span class="nx">r</span> <span class="nx">Repository</span><span class="p">)</span> <span class="o">*</span><span class="nx">Service</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Service</span><span class="p">{</span><span class="nx">r</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Service</span><span class="p">)</span> <span class="nf">Do</span><span class="p">()</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nf">Get</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒè¿˜å…è®¸æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆæ¨¡æ‹Ÿå‚æ•° ( ä¾‹å¦‚ä½¿ç”¨ <a class="link" href="https://github.com/vektra/mockery"  target="_blank" rel="noopener"
    >mockery</a> ) å’Œè½»æ¾åœ°ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä¸å—ç‰¹å®šå®ç°çš„çº¦æŸï¼Œæ¥å°†ä¸€ä¸ªç»„ä»¶æ›´æ”¹ä¸ºå¦ä¸€ä¸ªç»„ä»¶ã€‚å¦‚æœæ–°ç»„ä»¶å®ç°äº†è¯¥æ¥å£ï¼Œåˆ™ä¸šåŠ¡é€»è¾‘ä¸­ä¸éœ€è¦è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚</p>
</blockquote>
<h2 id="æ•´æ´æ¶æ„ä¹‹é“">æ•´æ´æ¶æ„ä¹‹é“</h2>
<h3 id="å…³é”®ç‚¹">å…³é”®ç‚¹</h3>
<p>ç¨‹åºå‘˜åœ¨ç¼–å†™äº†å¤§é‡ä»£ç åæ‰æ„è¯†åˆ°åº”ç”¨ç¨‹åºçš„æœ€ä½³æ¶æ„ã€‚</p>
<blockquote>
<p>ä¸€ä¸ªå¥½çš„æ¶æ„å…è®¸å°½å¯èƒ½æ¨è¿Ÿå†³ç­–ã€‚</p>
</blockquote>
<h3 id="ä¸»è¦åŸåˆ™">ä¸»è¦åŸåˆ™</h3>
<p>Dependency Inversion ( ä¸ SOLID ç›¸åŒ  ) æ˜¯ä¾èµ–å€’ç½®çš„åŸåˆ™ã€‚ä¾èµ–å…³ç³»çš„æ–¹å‘æ˜¯ä»å¤–å±‚åˆ°å†…å±‚ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œä¸šåŠ¡é€»è¾‘å’Œå®ä½“ä»ç„¶ç‹¬ç«‹äºç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†ã€‚</p>
<p>å› æ­¤ï¼Œåº”ç”¨ç¨‹åºåˆ†ä¸ºå†…éƒ¨å’Œå¤–éƒ¨ä¸¤ä¸ªå±‚æ¬¡ :</p>
<ul>
<li><strong>ä¸šåŠ¡é€»è¾‘</strong> ( ä½¿ç”¨ Go æ ‡å‡†åº“ )</li>
<li><strong>å·¥å…·</strong> ( æ•°æ®åº“ã€å…¶ä»–æœåŠ¡ã€æ¶ˆæ¯ä»£ç†ã€ä»»ä½•å…¶ä»–åŒ…å’Œæ¡†æ¶ )</li>
</ul>
<p><img src="http://img.golang.space/shot-1629076288722.png"
	
	
	
	loading="lazy"
	
		alt="Clean Architecture"
	
	
></p>
<p><strong>ä¸šåŠ¡é€»è¾‘çš„å†…å±‚</strong>åº”è¯¥æ˜¯æ•´æ´çš„ï¼Œå®ƒåº”è¯¥ :</p>
<ul>
<li>æ²¡æœ‰ä»å¤–å±‚å¯¼å…¥çš„åŒ…</li>
<li>åªä½¿ç”¨æ ‡å‡†åº“çš„åŠŸèƒ½</li>
<li>é€šè¿‡æ¥å£è°ƒç”¨å¤–å±‚ !</li>
</ul>
<p>ä¸šåŠ¡é€»è¾‘å¯¹ Postgres æˆ–è¯¦ç»†çš„ web API ä¸€æ— æ‰€çŸ¥ã€‚ä¸šåŠ¡é€»è¾‘åº”è¯¥å…·æœ‰ä¸€ä¸ªç”¨äºå¤„ç†æŠ½è±¡æ•°æ®åº“æˆ–æŠ½è±¡ web API çš„æ¥å£ã€‚</p>
<p><strong>å¤–å±‚</strong>è¿˜æœ‰å…¶ä»–é™åˆ¶ :</p>
<ul>
<li>è¿™ä¸€å±‚çš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†éƒ½ä¸çŸ¥é“å½¼æ­¤çš„å­˜åœ¨ã€‚å¦‚ä½•ä»ä¸€ä¸ªå·¥å…·è°ƒç”¨å¦ä¸€ä¸ªå·¥å…·ï¼Ÿä¸æ˜¯ç›´æ¥ï¼Œè€Œæ˜¯åªèƒ½é€šè¿‡å†…å±‚çš„ä¸šåŠ¡é€»è¾‘æ¥è°ƒç”¨ã€‚</li>
<li>å¯¹å†…å±‚çš„æ‰€æœ‰è°ƒç”¨éƒ½æ˜¯é€šè¿‡æ¥å£æ¥å®Œæˆçš„</li>
<li>æ•°æ®ä»¥ä¾¿äºä¸šåŠ¡é€»è¾‘çš„æ ¼å¼ä¼ è¾“ ( <code>internal/domain</code> )</li>
</ul>
<p>ä¾‹å¦‚ï¼Œä½ éœ€è¦ä» HTTP ( æ§åˆ¶å™¨ ) è®¿é—®æ•°æ®åº“ã€‚HTTP å’Œæ•°æ®åº“éƒ½åœ¨å¤–å±‚ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯¹å½¼æ­¤ä¸€æ— æ‰€çŸ¥ã€‚å®ƒä»¬ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡ <code>service </code> ( ä¸šåŠ¡é€»è¾‘ ) è¿›è¡Œçš„ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">    HTTP &gt; service
</span></span><span class="line"><span class="cl">           service &gt; repository <span class="o">(</span>Postgres<span class="o">)</span>
</span></span><span class="line"><span class="cl">           service &lt; repository <span class="o">(</span>Postgres<span class="o">)</span>
</span></span><span class="line"><span class="cl">    HTTP &lt; service
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¦å· &gt; å’Œ &lt; é€šè¿‡æ¥å£æ˜¾ç¤ºå±‚ä¸å±‚è¾¹ç•Œçš„äº¤é›†ï¼Œå¦‚å›¾æ‰€ç¤º :</p>
<p><img src="http://img.golang.space/shot-1629110764044.png"
	
	
	
	loading="lazy"
	
		alt="Example"
	
	
></p>
<p>æˆ–è€…æ›´å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">    HTTP &gt; service
</span></span><span class="line"><span class="cl">           service &gt; repository
</span></span><span class="line"><span class="cl">           service &lt; repository
</span></span><span class="line"><span class="cl">           service &gt; webapi
</span></span><span class="line"><span class="cl">           service &lt; webapi
</span></span><span class="line"><span class="cl">           service &gt; RPC
</span></span><span class="line"><span class="cl">           service &lt; RPC
</span></span><span class="line"><span class="cl">           service &gt; repository
</span></span><span class="line"><span class="cl">           service &lt; repository
</span></span><span class="line"><span class="cl">    HTTP &lt; service
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å±‚çº§">å±‚çº§</h3>
<p><img src="http://img.golang.space/shot-1629110769248.png"
	
	
	
	loading="lazy"
	
		alt="Example"
	
	
></p>
<p>æ•´æ´æ¶æ„çš„æœ¯è¯­</p>
<ul>
<li><strong>å®ä½“æ˜¯ä¸šåŠ¡é€»è¾‘æ“ä½œçš„ç»“æ„</strong>ã€‚å®ƒä»¬ä½äº <code>internal/domain</code> æ–‡ä»¶å¤¹ä¸­ã€‚Domain æš—ç¤ºæˆ‘ä»¬åšæŒ DDD ( é¢†åŸŸé©±åŠ¨è®¾è®¡ ) çš„åŸåˆ™ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯æ­£ç¡®çš„ã€‚åœ¨ MVC æœ¯è¯­ä¸­ï¼Œå®ä½“å°±æ˜¯æ¨¡å‹ã€‚</li>
<li><strong>ç”¨ä¾‹</strong>æ˜¯ä½äº <code>internal/service</code> ä¸­çš„ä¸šåŠ¡é€»è¾‘ã€‚ä»æ•´æ´æ¶æ„çš„è§’åº¦æ¥çœ‹ï¼Œè°ƒç”¨ä¸šåŠ¡é€»è¾‘ä½¿ç”¨ <code>service</code> ä¸€è¯ä¸æ˜¯ä¹ æƒ¯çš„ç”¨æ³•ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªåŒ…åç§°æ¥è¯´ï¼Œä½¿ç”¨ä¸€ä¸ªå•è¯ ( service ) æ¯”ä½¿ç”¨ä¸¤ä¸ªå•è¯ ( use case ) æ›´æ–¹ä¾¿ã€‚</li>
</ul>
<p>ä¸šåŠ¡é€»è¾‘ç›´æ¥äº¤äº’çš„å±‚é€šå¸¸ç§°ä¸ºåŸºç¡€è®¾æ–½å±‚ã€‚å®ƒä»¬å¯ä»¥æ˜¯å­˜å‚¨åº“ <code>internal/service/repo</code>ã€web API <code>internal/service/webapi</code>ã€ä»»ä½•pkgï¼Œä»¥åŠå…¶ä»–å¾®æœåŠ¡ã€‚åœ¨æ¨¡æ¿ä¸­ï¼Œ_ infrastructure åŒ…ä½äº <code>internal/service</code> ä¸­ã€‚</p>
<p>ä½ å¯ä»¥æ ¹æ®éœ€è¦å»é€‰æ‹©å¦‚ä½•è°ƒç”¨å…¥å£ç‚¹ã€‚é€‰é¡¹å¦‚ä¸‹ :</p>
<ul>
<li>delivery (in our case)</li>
<li>controllers</li>
<li>transport</li>
<li>gateways</li>
<li>entrypoints</li>
<li>primary</li>
<li>input</li>
</ul>
<h3 id="é™„åŠ å±‚">é™„åŠ å±‚</h3>
<p>ç»å…¸ç‰ˆæœ¬çš„ <a class="link" href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"  target="_blank" rel="noopener"
    >æ•´æ´æ¶æ„ä¹‹é“</a> æ˜¯ä¸ºæ„å»ºå¤§å‹å•ä½“åº”ç”¨ç¨‹åºè€Œè®¾è®¡çš„ï¼Œå®ƒæœ‰4å±‚ã€‚</p>
<p>åœ¨æœ€åˆçš„ç‰ˆæœ¬ä¸­ï¼Œå¤–å±‚è¢«åˆ†ä¸ºä¸¤ä¸ªä»¥ä¸Šçš„å±‚ï¼Œä¸¤å±‚ä¹‹é—´ä¹Ÿå­˜åœ¨ç›¸äº’ä¾èµ–å…³ç³»å€’ç½® ( å®šå‘å†…éƒ¨ )ï¼Œå¹¶é€šè¿‡æ¥å£è¿›è¡Œé€šä¿¡ã€‚</p>
<p>åœ¨é€»è¾‘å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå†…å±‚ä¹Ÿåˆ†ä¸ºä¸¤ä¸ª( æ¥å£åˆ†ç¦» )ã€‚</p>
<p>å¤æ‚çš„å·¥å…·å¯ä»¥è¢«åˆ’åˆ†æˆæ›´å¤šçš„é™„åŠ å±‚ï¼Œä½†ä½ åº”è¯¥åœ¨ç¡®å®éœ€è¦æ—¶å†æ·»åŠ å±‚ã€‚</p>
<h3 id="æ›¿ä»£æ–¹æ³•">æ›¿ä»£æ–¹æ³•</h3>
<p>é™¤äº†æ•´æ´æ¶æ„ä¹‹é“ï¼Œæ´‹è‘±æ¶æ„å’Œå…­è¾¹å½¢æ¶æ„ ( ç«¯å£é€‚é…å™¨æ¨¡å¼ ) æ˜¯ç±»ä¼¼çš„ã€‚ä¸¤è€…éƒ½æ˜¯åŸºäºä¾èµ–å€’ç½®çš„åŸåˆ™ã€‚ç«¯å£å’Œé€‚é…å™¨æ¨¡å¼éå¸¸æ¥è¿‘äºæ•´æ´æ¶æ„ä¹‹é“ï¼Œå·®å¼‚ä¸»è¦åœ¨æœ¯è¯­ä¸Šã€‚</p>
<h2 id="ç±»ä¼¼çš„é¡¹ç›®">ç±»ä¼¼çš„é¡¹ç›®</h2>
<ul>
<li><a class="link" href="https://github.com/bxcodec/go-clean-arch"  target="_blank" rel="noopener"
    >https://github.com/bxcodec/go-clean-arch</a></li>
<li><a class="link" href="https://github.com/zhashkevych/courses-backend"  target="_blank" rel="noopener"
    >https://github.com/zhashkevych/courses-backend</a></li>
</ul>
<h2 id="æ‰©å±•é˜…è¯»é“¾æ¥">æ‰©å±•é˜…è¯»é“¾æ¥</h2>
<ul>
<li><a class="link" href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"  target="_blank" rel="noopener"
    >æ•´æ´æ¶æ„ä¹‹é“</a></li>
<li><a class="link" href="https://12factor.net/ru/"  target="_blank" rel="noopener"
    >12 è¦ç´ </a></li>
</ul>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/circuit-breakers-in-golang/">
        
        
            <div class="article-image">
                
                    <img src="http://img.golang.space/shot-1626770277464.png" loading="lazy" data-key="" data-hash="http://img.golang.space/shot-1626770277464.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Circuit Breakers in Golang</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="ixugo/ixugo.github.io"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
  <section class="copyright">
    &copy;
    
    2018 -
    
    2025 ixugo
  </section>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <section class="powerby">

    
    <span id="busuanzi_container_page_pv">æœ¬æ–‡é˜…è¯»é‡
      <span style="font-size: 14px" id="busuanzi_value_page_pv"></span>
      æ¬¡ï¼Œ</span>
    <span id="busuanzi_container_site_pv">æ€»è®¿é—®é‡
      <span style="font-size: 14px" id="busuanzi_value_site_pv"></span>
      æ¬¡ </span>ï¼Œæ€»è®¿å®¢æ•°
    <span style="font-size: 14px" id="busuanzi_value_site_uv"></span> äºº
    <br />


    Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> .&nbsp;&nbsp;
    Theme <a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
      data-version="3.16.0">Stack</a> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
  </section>




  <script>
    function count() {
      let href = window.location.href;
      let regexp = /^https?:\/\/blog.golang.space\/?(page\/[\d]+\/?)?$/;
      if (regexp.test(href)) {
        let e = document.getElementById("busuanzi_container_page_pv");
        e.innerText = "";
      }
    }
    window.onload = count;
  </script>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
