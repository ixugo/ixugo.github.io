<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='âš¡ZAP ç®€ä»‹ zap æ˜¯ä»€ä¹ˆ? âš¡ZAP æ˜¯uber å¼€æºçš„æä¾›å¿«é€Ÿï¼Œç»“æ„åŒ–ï¼Œé«˜æ€§èƒ½çš„æ—¥å¿—è®°å½•åŒ…ã€‚
zap é«˜æ€§èƒ½ä½“ç°åœ¨å“ªé‡Œ? åœ¨ä»‹ç»zapåŒ…çš„ä¼˜åŒ–éƒ¨åˆ†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹zapæ—¥å¿—åº“çš„å·¥ä½œæµç¨‹å›¾
å¤§å¤šæ•°æ—¥å¿—åº“æä¾›çš„æ–¹å¼æ˜¯åŸºäºåå°„çš„åºåˆ—åŒ–å’Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œè¿™ç§æ–¹å¼ä»£ä»·é«˜æ˜‚ï¼Œè€Œ Zap é‡‡å–ä¸åŒçš„æ–¹æ³•ã€‚
é¿å… interface{} ä½¿ç”¨å¼ºç±»å‹è®¾è®¡
å°è£…å¼ºç±»å‹ï¼Œæ— åå°„
ä½¿ç”¨é›¶åˆ†é…å†…å­˜çš„ JSON ç¼–ç å™¨ï¼Œå°½å¯èƒ½é¿å…åºåˆ—åŒ–å¼€é”€ï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–æ—¥å¿—åŒ…å¿« 4 - 10 å€ã€‚
1 2 3 4 5 logger.Info(&amp;#34;failed to fetch URL&amp;#34;, zap.String(&amp;#34;url&amp;#34;, &amp;#34;https://baidu.com&amp;#34;), zap.Int(&amp;#34;attempt&amp;#34;, 3), zap.Duration(&amp;#34;backoff&amp;#34;, time.Second), ) ä½¿ç”¨ sync.Pool ä»¥é¿å…è®°å½•æ¶ˆæ¯æ—¶çš„å†…å­˜åˆ†é… è¯¦æƒ…åœ¨ä¸‹æ–‡ zapcore æ¨¡å—ä»‹ç»ã€‚
Example å®‰è£… 1 go get -u go.uber.org/zap Zap æä¾›äº†ä¸¤ç§ç±»å‹çš„ logger
SugaredLogger Logger åœ¨æ€§èƒ½è‰¯å¥½ä½†ä¸æ˜¯å…³é”®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ SugaredLoggerï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–çš„æ—¥å¿—åŒ…å¿« 4-10 å€ï¼Œå¹¶ä¸”æ”¯æŒç»“æ„åŒ–å’Œ printf é£æ ¼çš„APIsã€‚
ä¾‹ä¸€ è°ƒç”¨ NewProduction åˆ›å»ºloggerå¯¹è±¡ 1 2 3 4 5 6 7 8 func TestSugar(t *testing.'>
<title>ä»æºç äº†è§£ zap</title>

<link rel='canonical' href='https://blog.golang.space/p/%E4%BB%8E%E6%BA%90%E7%A0%81%E4%BA%86%E8%A7%A3-zap/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='ä»æºç äº†è§£ zap'>
<meta property='og:description' content='âš¡ZAP ç®€ä»‹ zap æ˜¯ä»€ä¹ˆ? âš¡ZAP æ˜¯uber å¼€æºçš„æä¾›å¿«é€Ÿï¼Œç»“æ„åŒ–ï¼Œé«˜æ€§èƒ½çš„æ—¥å¿—è®°å½•åŒ…ã€‚
zap é«˜æ€§èƒ½ä½“ç°åœ¨å“ªé‡Œ? åœ¨ä»‹ç»zapåŒ…çš„ä¼˜åŒ–éƒ¨åˆ†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹zapæ—¥å¿—åº“çš„å·¥ä½œæµç¨‹å›¾
å¤§å¤šæ•°æ—¥å¿—åº“æä¾›çš„æ–¹å¼æ˜¯åŸºäºåå°„çš„åºåˆ—åŒ–å’Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œè¿™ç§æ–¹å¼ä»£ä»·é«˜æ˜‚ï¼Œè€Œ Zap é‡‡å–ä¸åŒçš„æ–¹æ³•ã€‚
é¿å… interface{} ä½¿ç”¨å¼ºç±»å‹è®¾è®¡
å°è£…å¼ºç±»å‹ï¼Œæ— åå°„
ä½¿ç”¨é›¶åˆ†é…å†…å­˜çš„ JSON ç¼–ç å™¨ï¼Œå°½å¯èƒ½é¿å…åºåˆ—åŒ–å¼€é”€ï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–æ—¥å¿—åŒ…å¿« 4 - 10 å€ã€‚
1 2 3 4 5 logger.Info(&amp;#34;failed to fetch URL&amp;#34;, zap.String(&amp;#34;url&amp;#34;, &amp;#34;https://baidu.com&amp;#34;), zap.Int(&amp;#34;attempt&amp;#34;, 3), zap.Duration(&amp;#34;backoff&amp;#34;, time.Second), ) ä½¿ç”¨ sync.Pool ä»¥é¿å…è®°å½•æ¶ˆæ¯æ—¶çš„å†…å­˜åˆ†é… è¯¦æƒ…åœ¨ä¸‹æ–‡ zapcore æ¨¡å—ä»‹ç»ã€‚
Example å®‰è£… 1 go get -u go.uber.org/zap Zap æä¾›äº†ä¸¤ç§ç±»å‹çš„ logger
SugaredLogger Logger åœ¨æ€§èƒ½è‰¯å¥½ä½†ä¸æ˜¯å…³é”®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ SugaredLoggerï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–çš„æ—¥å¿—åŒ…å¿« 4-10 å€ï¼Œå¹¶ä¸”æ”¯æŒç»“æ„åŒ–å’Œ printf é£æ ¼çš„APIsã€‚
ä¾‹ä¸€ è°ƒç”¨ NewProduction åˆ›å»ºloggerå¯¹è±¡ 1 2 3 4 5 6 7 8 func TestSugar(t *testing.'>
<meta property='og:url' content='https://blog.golang.space/p/%E4%BB%8E%E6%BA%90%E7%A0%81%E4%BA%86%E8%A7%A3-zap/'>
<meta property='og:site_name' content='ixugo'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='æ—¥å¿—' /><meta property='article:published_time' content='2021-01-22T15:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-01-22T15:00:00&#43;00:00'/>
<meta name="twitter:title" content="ä»æºç äº†è§£ zap">
<meta name="twitter:description" content="âš¡ZAP ç®€ä»‹ zap æ˜¯ä»€ä¹ˆ? âš¡ZAP æ˜¯uber å¼€æºçš„æä¾›å¿«é€Ÿï¼Œç»“æ„åŒ–ï¼Œé«˜æ€§èƒ½çš„æ—¥å¿—è®°å½•åŒ…ã€‚
zap é«˜æ€§èƒ½ä½“ç°åœ¨å“ªé‡Œ? åœ¨ä»‹ç»zapåŒ…çš„ä¼˜åŒ–éƒ¨åˆ†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹zapæ—¥å¿—åº“çš„å·¥ä½œæµç¨‹å›¾
å¤§å¤šæ•°æ—¥å¿—åº“æä¾›çš„æ–¹å¼æ˜¯åŸºäºåå°„çš„åºåˆ—åŒ–å’Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œè¿™ç§æ–¹å¼ä»£ä»·é«˜æ˜‚ï¼Œè€Œ Zap é‡‡å–ä¸åŒçš„æ–¹æ³•ã€‚
é¿å… interface{} ä½¿ç”¨å¼ºç±»å‹è®¾è®¡
å°è£…å¼ºç±»å‹ï¼Œæ— åå°„
ä½¿ç”¨é›¶åˆ†é…å†…å­˜çš„ JSON ç¼–ç å™¨ï¼Œå°½å¯èƒ½é¿å…åºåˆ—åŒ–å¼€é”€ï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–æ—¥å¿—åŒ…å¿« 4 - 10 å€ã€‚
1 2 3 4 5 logger.Info(&amp;#34;failed to fetch URL&amp;#34;, zap.String(&amp;#34;url&amp;#34;, &amp;#34;https://baidu.com&amp;#34;), zap.Int(&amp;#34;attempt&amp;#34;, 3), zap.Duration(&amp;#34;backoff&amp;#34;, time.Second), ) ä½¿ç”¨ sync.Pool ä»¥é¿å…è®°å½•æ¶ˆæ¯æ—¶çš„å†…å­˜åˆ†é… è¯¦æƒ…åœ¨ä¸‹æ–‡ zapcore æ¨¡å—ä»‹ç»ã€‚
Example å®‰è£… 1 go get -u go.uber.org/zap Zap æä¾›äº†ä¸¤ç§ç±»å‹çš„ logger
SugaredLogger Logger åœ¨æ€§èƒ½è‰¯å¥½ä½†ä¸æ˜¯å…³é”®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ SugaredLoggerï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–çš„æ—¥å¿—åŒ…å¿« 4-10 å€ï¼Œå¹¶ä¸”æ”¯æŒç»“æ„åŒ–å’Œ printf é£æ ¼çš„APIsã€‚
ä¾‹ä¸€ è°ƒç”¨ NewProduction åˆ›å»ºloggerå¯¹è±¡ 1 2 3 4 5 6 7 8 func TestSugar(t *testing.">
    <link rel="shortcut icon" href="img/favicon.ico" />

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-192125643-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu0b04ba6d7249c9f90c92db974439eb8c_208246_300x0_resize_box_3.png" width="300"
                            height="321" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ§</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ixugo</a></h1>
            <h2 class="site-description">èµ°å‡ºèˆ’é€‚åŒº</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/ixugo'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#zaphttpsgithubcomuber-gozap"><a href="https://github.com/uber-go/zap">âš¡ZAP</a></a></li>
    <li><a href="#ç®€ä»‹">ç®€ä»‹</a>
      <ol>
        <li><a href="#zap-æ˜¯ä»€ä¹ˆ">zap æ˜¯ä»€ä¹ˆ?</a></li>
        <li><a href="#zap-é«˜æ€§èƒ½ä½“ç°åœ¨å“ªé‡Œ">zap é«˜æ€§èƒ½ä½“ç°åœ¨å“ªé‡Œ?</a></li>
      </ol>
    </li>
    <li><a href="#example">Example</a>
      <ol>
        <li><a href="#å®‰è£…">å®‰è£…</a></li>
        <li><a href="#a-idexample_1ä¾‹ä¸€-aè°ƒç”¨-newproduction-åˆ›å»ºloggerå¯¹è±¡"><!-- raw HTML omitted -->ä¾‹ä¸€ <!-- raw HTML omitted -->è°ƒç”¨ NewProduction åˆ›å»ºloggerå¯¹è±¡</a></li>
        <li><a href="#a-nameexample_2ä¾‹äºŒa-è°ƒç”¨-newdevelopment-åˆ›å»ºloggerå¯¹è±¡"><!-- raw HTML omitted -->ä¾‹äºŒ<!-- raw HTML omitted --> è°ƒç”¨ NewDevelopment åˆ›å»ºloggerå¯¹è±¡</a></li>
        <li><a href="#ä¾‹ä¸‰-logger-ä¸-sugaredlogger-ç›¸äº’è½¬æ¢">ä¾‹ä¸‰ <code>Logger</code> ä¸ <code>SugaredLogger</code> ç›¸äº’è½¬æ¢</a></li>
        <li><a href="#a-nameexample_4ä¾‹å››a-è‡ªå®šä¹‰æ ¼å¼"><!-- raw HTML omitted -->ä¾‹å››<!-- raw HTML omitted --> è‡ªå®šä¹‰æ ¼å¼</a></li>
      </ol>
    </li>
    <li><a href="#æºç åˆ†æ">æºç åˆ†æ</a>
      <ol>
        <li>
          <ol>
            <li><a href="#logger">Logger</a></li>
            <li><a href="#sugaredlogger">SugaredLogger</a></li>
            <li><a href="#zapcore">zapcore</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#doc">Doc</a></li>
    <li><a href="#qa">QA</a>
      <ol>
        <li><a href="#è®¾è®¡é—®é¢˜">è®¾è®¡é—®é¢˜</a>
          <ol>
            <li><a href="#ä¸ºä»€ä¹ˆè¦åœ¨loggeræ€§èƒ½ä¸ŠèŠ±è´¹è¿™ä¹ˆå¤šç²¾åŠ›å‘¢">ä¸ºä»€ä¹ˆè¦åœ¨Loggeræ€§èƒ½ä¸ŠèŠ±è´¹è¿™ä¹ˆå¤šç²¾åŠ›å‘¢ï¼Ÿ</a></li>
            <li><a href="#ä¸ºä»€ä¹ˆæ²¡æœ‰loggerå’Œsugaredloggeræ¥å£">ä¸ºä»€ä¹ˆæ²¡æœ‰<code>Logger</code>å’Œ<code>SugaredLogger</code>æ¥å£ï¼Ÿ</a></li>
            <li><a href="#ä¸ºä»€ä¹ˆæˆ‘çš„ä¸€äº›æ—¥å¿—ä¼šä¸¢å¤±">ä¸ºä»€ä¹ˆæˆ‘çš„ä¸€äº›æ—¥å¿—ä¼šä¸¢å¤±ï¼Ÿ</a></li>
            <li><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¤ºä¾‹åº”ç”¨ç¨‹åºæ—¥å¿—">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¤ºä¾‹åº”ç”¨ç¨‹åºæ—¥å¿—ï¼Ÿ</a></li>
            <li><a href="#ä¸ºä»€ä¹ˆç»“æ„åŒ–çš„æ—¥å¿—-api-é™¤äº†æ¥å—å­—æ®µä¹‹å¤–è¿˜å¯ä»¥æ¥æ”¶æ¶ˆæ¯">ä¸ºä»€ä¹ˆç»“æ„åŒ–çš„æ—¥å¿— API é™¤äº†æ¥å—å­—æ®µä¹‹å¤–è¿˜å¯ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Ÿ</a></li>
            <li><a href="#ä¸ºä»€ä¹ˆè¦åŒ…æ‹¬å…¨å±€-loggers">ä¸ºä»€ä¹ˆè¦åŒ…æ‹¬å…¨å±€ loggersï¼Ÿ</a></li>
            <li><a href="#ä¸ºä»€ä¹ˆåŒ…æ‹¬ä¸“ç”¨çš„panicå’Œfatalæ—¥å¿—çº§åˆ«">ä¸ºä»€ä¹ˆåŒ…æ‹¬ä¸“ç”¨çš„Panicå’ŒFatalæ—¥å¿—çº§åˆ«ï¼Ÿ</a></li>
            <li><a href="#ä»€ä¹ˆæ˜¯dpanic">ä»€ä¹ˆæ˜¯<code>DPanic</code>?</a></li>
          </ol>
        </li>
        <li><a href="#å®‰è£…é—®é¢˜">å®‰è£…é—®é¢˜</a>
          <ol>
            <li><a href="#é”™è¯¯expects-import-gouberorgzapæ˜¯ä»€ä¹ˆæ„æ€">é”™è¯¯<code>expects import &quot;go.uber.org/zap&quot;</code>æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</a></li>
          </ol>
        </li>
        <li><a href="#ç”¨æ³•é—®é¢˜">ç”¨æ³•é—®é¢˜</a>
          <ol>
            <li><a href="#zapæ˜¯å¦æ”¯æŒæ—¥å¿—åˆ‡å‰²">Zapæ˜¯å¦æ”¯æŒæ—¥å¿—åˆ‡å‰²ï¼Ÿ</a></li>
            <li><a href="#æ’ä»¶">æ’ä»¶</a></li>
          </ol>
        </li>
        <li><a href="#æ€§èƒ½æ¯”è¾ƒ">æ€§èƒ½æ¯”è¾ƒ</a></li>
        <li><a href="#ç›¸ä¼¼çš„åº“">ç›¸ä¼¼çš„åº“</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E4%BB%8E%E6%BA%90%E7%A0%81%E4%BA%86%E8%A7%A3-zap/">ä»æºç äº†è§£ zap</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 22, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    11 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="zaphttpsgithubcomuber-gozap"><a class="link" href="https://github.com/uber-go/zap"  target="_blank" rel="noopener"
    >âš¡ZAP</a></h2>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<h3 id="zap-æ˜¯ä»€ä¹ˆ">zap æ˜¯ä»€ä¹ˆ?</h3>
<p><a class="link" href="https://github.com/uber-go/zap"  target="_blank" rel="noopener"
    >âš¡ZAP</a> æ˜¯uber å¼€æºçš„æä¾›å¿«é€Ÿï¼Œç»“æ„åŒ–ï¼Œé«˜æ€§èƒ½çš„æ—¥å¿—è®°å½•åŒ…ã€‚</p>
<h3 id="zap-é«˜æ€§èƒ½ä½“ç°åœ¨å“ªé‡Œ">zap é«˜æ€§èƒ½ä½“ç°åœ¨å“ªé‡Œ?</h3>
<p>åœ¨ä»‹ç»zapåŒ…çš„ä¼˜åŒ–éƒ¨åˆ†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹zapæ—¥å¿—åº“çš„å·¥ä½œæµç¨‹å›¾</p>
<p><img src="https://cdn-images-1.medium.com/max/644/1*4mn192sJdR0rU8RQ3aQo4w.png"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p>å¤§å¤šæ•°æ—¥å¿—åº“æä¾›çš„æ–¹å¼æ˜¯åŸºäºåå°„çš„åºåˆ—åŒ–å’Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œè¿™ç§æ–¹å¼ä»£ä»·é«˜æ˜‚ï¼Œè€Œ Zap é‡‡å–ä¸åŒçš„æ–¹æ³•ã€‚</p>
<ul>
<li>
<p>é¿å… interface{} ä½¿ç”¨å¼ºç±»å‹è®¾è®¡</p>
</li>
<li>
<p>å°è£…å¼ºç±»å‹ï¼Œæ— åå°„</p>
</li>
<li>
<p>ä½¿ç”¨é›¶åˆ†é…å†…å­˜çš„ JSON ç¼–ç å™¨ï¼Œå°½å¯èƒ½é¿å…åºåˆ—åŒ–å¼€é”€ï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–æ—¥å¿—åŒ…å¿« 4 - 10 å€ã€‚</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">logger</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="s">&#34;failed to fetch URL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;url&#34;</span><span class="p">,</span> <span class="s">&#34;https://baidu.com&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;attempt&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="s">&#34;backoff&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨ sync.Pool ä»¥é¿å…è®°å½•æ¶ˆæ¯æ—¶çš„å†…å­˜åˆ†é…</li>
</ul>
<p>è¯¦æƒ…åœ¨ä¸‹æ–‡ zapcore æ¨¡å—ä»‹ç»ã€‚</p>
<h2 id="example">Example</h2>
<h3 id="å®‰è£…">å®‰è£…</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get -u go.uber.org/zap
</span></span></code></pre></td></tr></table>
</div>
</div><p>Zap æä¾›äº†ä¸¤ç§ç±»å‹çš„ logger</p>
<ul>
<li>SugaredLogger</li>
<li>Logger</li>
</ul>
<p>åœ¨<strong>æ€§èƒ½è‰¯å¥½ä½†ä¸æ˜¯å…³é”®</strong>çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <strong>SugaredLogger</strong>ï¼Œå®ƒæ¯”å…¶ä»–ç»“æ„åŒ–çš„æ—¥å¿—åŒ…å¿« 4-10 å€ï¼Œå¹¶ä¸”æ”¯æŒç»“æ„åŒ–å’Œ <code>printf</code> é£æ ¼çš„APIsã€‚</p>
<h3 id="a-idexample_1ä¾‹ä¸€-aè°ƒç”¨-newproduction-åˆ›å»ºloggerå¯¹è±¡"><!-- raw HTML omitted -->ä¾‹ä¸€ <!-- raw HTML omitted -->è°ƒç”¨ NewProduction åˆ›å»ºloggerå¯¹è±¡</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestSugar</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewProduction</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é»˜è®¤ logger ä¸ç¼“å†²ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// ä½†ç”±äºåº•å±‚ api å…è®¸ç¼“å†²ï¼Œæ‰€ä»¥åœ¨è¿›ç¨‹é€€å‡ºä¹‹å‰è°ƒç”¨ Sync æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">defer</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugar</span> <span class="o">:=</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sugar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugar</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;Failed to fetch URL: %s&#34;</span><span class="p">,</span> <span class="s">&#34;https://baidu.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹<strong>æ€§èƒ½å’Œç±»å‹å®‰å…¨è¦æ±‚ä¸¥æ ¼</strong>çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ <strong>Logger</strong> ï¼Œå®ƒç”šè‡³æ¯”å‰è€…<strong>SugaredLogger</strong>æ›´å¿«ï¼Œå†…å­˜åˆ†é…æ¬¡æ•°ä¹Ÿæ›´å°‘ï¼Œä½†å®ƒä»…æ”¯æŒå¼ºç±»å‹çš„ç»“æ„åŒ–æ—¥å¿—è®°å½•ã€‚</p>
<h3 id="a-nameexample_2ä¾‹äºŒa-è°ƒç”¨-newdevelopment-åˆ›å»ºloggerå¯¹è±¡"><!-- raw HTML omitted -->ä¾‹äºŒ<!-- raw HTML omitted --> è°ƒç”¨ NewDevelopment åˆ›å»ºloggerå¯¹è±¡</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestLogger</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewDevelopment</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="s">&#34;failed to fetch URL&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å¼ºç±»å‹å­—æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">zap</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;url&#34;</span><span class="p">,</span> <span class="s">&#34;https://baidu.com&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">Int</span><span class="p">(</span><span class="s">&#34;attempt&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zap</span><span class="p">.</span><span class="nf">Duration</span><span class="p">(</span><span class="s">&#34;backoff&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸éœ€è¦ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºå†³å®šé€‰æ‹©ä½¿ç”¨ <code>Logger</code> è¿˜æ˜¯ <code>SugaredLogger</code> ï¼Œä¸¤è€…ä¹‹é—´éƒ½å¯ä»¥è½»æ¾è½¬æ¢ã€‚</p>
<h3 id="ä¾‹ä¸‰-logger-ä¸-sugaredlogger-ç›¸äº’è½¬æ¢">ä¾‹ä¸‰ <code>Logger</code> ä¸ <code>SugaredLogger</code> ç›¸äº’è½¬æ¢</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// åˆ›å»º logger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">logger</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewExample</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">defer</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è½¬æ¢ SugaredLogger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">sugar</span> <span class="o">:=</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sugar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è½¬æ¢ logger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">plain</span> <span class="o">:=</span> <span class="nx">sugar</span><span class="p">.</span><span class="nf">Desugar</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="a-nameexample_4ä¾‹å››a-è‡ªå®šä¹‰æ ¼å¼"><!-- raw HTML omitted -->ä¾‹å››<!-- raw HTML omitted --> è‡ªå®šä¹‰æ ¼å¼</h3>
<p>è‡ªå®šä¹‰ä¸€ä¸ªæ—¥å¿—æ¶ˆæ¯æ ¼å¼ï¼Œå¸¦ç€é—®é¢˜çœ‹ä¸‹åˆ—ä»£ç ã€‚</p>
<ol>
<li>debug çº§åˆ«çš„æ—¥å¿—æ‰“å°åˆ°æ§åˆ¶å°äº†å—?</li>
<li>æœ€åçš„ error ä¼šæ‰“å°åˆ°æ§åˆ¶å°å— ?</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;go.uber.org/zap/zapcore&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewCustomEncoderConfig</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">TimeKey</span><span class="p">:</span>        <span class="s">&#34;ts&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">LevelKey</span><span class="p">:</span>       <span class="s">&#34;level&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">NameKey</span><span class="p">:</span>        <span class="s">&#34;logger&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">CallerKey</span><span class="p">:</span>      <span class="s">&#34;caller&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">FunctionKey</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">OmitKey</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MessageKey</span><span class="p">:</span>     <span class="s">&#34;msg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">StacktraceKey</span><span class="p">:</span>  <span class="s">&#34;stacktrace&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">LineEnding</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DefaultLineEnding</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">EncodeLevel</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">CapitalColorLevelEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">EncodeTime</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nf">TimeEncoderOfLayout</span><span class="p">(</span><span class="s">&#34;2006-01-02 15:04:05&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">EncodeDuration</span><span class="p">:</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">SecondsDurationEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">EncodeCaller</span><span class="p">:</span>   <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ShortCallerEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">atom</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">NewAtomicLevelAt</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nx">DebugLevel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">core</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewConsoleEncoder</span><span class="p">(</span><span class="nf">NewCustomEncoderConfig</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewMultiWriteSyncer</span><span class="p">(</span><span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">atom</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logger</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">core</span><span class="p">,</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">AddCaller</span><span class="p">(),</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">Development</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// é…ç½® zap åŒ…çš„å…¨å±€å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">zap</span><span class="p">.</span><span class="nf">ReplaceGlobals</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è¿è¡Œæ—¶å®‰å…¨åœ°æ›´æ”¹ logger æ—¥è®°çº§åˆ«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">atom</span><span class="p">.</span><span class="nf">SetLevel</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugar</span> <span class="o">:=</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">Sugar</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é—®é¢˜ 1: debug çº§åˆ«çš„æ—¥å¿—æ‰“å°åˆ°æ§åˆ¶å°äº†å—?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">sugar</span><span class="p">.</span><span class="nf">Debug</span><span class="p">(</span><span class="s">&#34;debug&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugar</span><span class="p">.</span><span class="nf">Info</span><span class="p">(</span><span class="s">&#34;info&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugar</span><span class="p">.</span><span class="nf">Warn</span><span class="p">(</span><span class="s">&#34;warn&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sugar</span><span class="p">.</span><span class="nf">DPanic</span><span class="p">(</span><span class="s">&#34;dPanic&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é—®é¢˜ 2: æœ€åçš„ error ä¼šæ‰“å°åˆ°æ§åˆ¶å°å—?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">sugar</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœè§ä¸‹å›¾</p>
<p><img src="http://img.golang.space/shot-1621945016655.png"
	
	
	
	loading="lazy"
	
		alt="image-20210525201656456"
	
	
></p>
<p><strong>é—®é¢˜ 1:</strong></p>
<p>æ²¡æœ‰æ‰“å°ã€‚AtomicLevel æ˜¯åŸå­æ€§å¯æ›´æ”¹çš„åŠ¨æ€æ—¥å¿—çº§åˆ«ï¼Œé€šè¿‡è°ƒç”¨ <code>atom.SetLevel</code> æ›´æ”¹æ—¥å¿—çº§åˆ«ä¸º <code>infoLevel</code> ã€‚</p>
<p><strong>é—®é¢˜ 2:</strong></p>
<p>æ²¡æœ‰æ‰“å°ã€‚<code>zap.Development()</code> å¯ç”¨äº†å¼€å‘æ¨¡å¼ï¼Œåœ¨å¼€å‘æ¨¡å¼ä¸‹ <code>DPanic</code> å‡½æ•°ä¼šå¼•å‘ panicï¼Œæ‰€ä»¥æœ€åçš„ <code>error</code> ä¸ä¼šæ‰“å°åˆ°æ§åˆ¶å°ã€‚</p>
<h2 id="æºç åˆ†æ">æºç åˆ†æ</h2>
<p>æ­¤æ¬¡æºç åˆ†æåŸºäº <code>Zap 1.16</code></p>
<p><img src="http://img.golang.space/shot-1620404974607.png"
	
	
	
	loading="lazy"
	
		alt="zapæ¦‚è§ˆ"
	
	
></p>
<p>ä¸Šå›¾ä»…è¡¨ç¤º zap å¯è°ƒç”¨ä¸¤ç§ loggerï¼Œæ²¡æœ‰è¡¨è¾¾ <code>Logger</code> ä¸ <code>SugaredLogger</code> çš„å…³ç³»ï¼Œ<strong>ç»§ç»­å¾€ä¸‹çœ‹</strong>ï¼Œä½ ä¼šæ›´ç†è§£ã€‚</p>
<h4 id="logger">Logger</h4>
<p>logger æä¾›å¿«é€Ÿï¼Œåˆ†çº§ï¼Œç»“æ„åŒ–çš„æ—¥å¿—è®°å½•ã€‚æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯å®‰å…¨çš„ï¼Œå†…å­˜åˆ†é…å¾ˆé‡è¦ï¼Œå› æ­¤å®ƒçš„ API æœ‰æ„åå‘äºæ€§èƒ½å’Œç±»å‹å®‰å…¨ã€‚</p>
<p><code>zap@v1.16.0 - logger.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Logger</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å®ç°ç¼–ç å’Œè¾“å‡ºçš„æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">core</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Core</span>  
</span></span><span class="line"><span class="cl">  <span class="c1">// è®°å½•å™¨å¼€å‘æ¨¡å¼ï¼ŒDPanic ç­‰çº§å°†è®°å½• panic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">development</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å¼€å¯è®°å½•è°ƒç”¨è€…çš„è¡Œå·å’Œå‡½æ•°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">addCaller</span>   <span class="kt">bool</span>		
</span></span><span class="line"><span class="cl">  <span class="c1">// è‡´å‘½æ—¥å¿—é‡‡å–çš„æ“ä½œï¼Œé»˜è®¤å†™å…¥æ—¥å¿—å os.Exit()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">onFatal</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">CheckWriteAction</span> 
</span></span><span class="line"><span class="cl">	<span class="nx">name</span>        <span class="kt">string</span>	
</span></span><span class="line"><span class="cl">  <span class="c1">// è®¾ç½®è®°å½•å™¨ç”Ÿæˆçš„é”™è¯¯ç›®çš„åœ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">errorOutput</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">WriteSyncer</span>  
</span></span><span class="line"><span class="cl">  <span class="c1">// è®°å½• &gt;= è¯¥æ—¥å¿—ç­‰çº§çš„å †æ ˆè¿½è¸ª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">addStack</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">LevelEnabler</span> 
</span></span><span class="line"><span class="cl">  <span class="c1">// é¿å…è®°å½•å™¨è®¤ä¸ºå°è£…å‡½æ•°ä¸ºè°ƒç”¨æ–¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">callerSkip</span> <span class="kt">int</span>	
</span></span><span class="line"><span class="cl">  <span class="c1">// é»˜è®¤ä¸ºç³»ç»Ÿæ—¶é—´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">clock</span> <span class="nx">Clock</span>		
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <strong>Example</strong> ä¸­åˆ†åˆ«ä½¿ç”¨äº† <code>NewProduction</code> å’Œ <code>NewDevelopment</code> ï¼Œæ¥ä¸‹æ¥ä»¥è¿™ä¸¤ä¸ªå‡½æ•°å¼€å§‹åˆ†æã€‚ä¸‹å›¾è¡¨ç¤º A å‡½æ•°è°ƒç”¨äº† B å‡½æ•°ï¼Œå…¶ä¸­ç®­å¤´è¡¨ç¤º<strong>å‡½æ•°è°ƒç”¨å…³ç³»</strong>ã€‚å›¾ä¸­å‡½æ•°éƒ½ä¼šåˆ†æåˆ°ã€‚</p>
<p><img src="http://img.golang.space/shot-1620608635804.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><strong>NewProduction</strong></p>
<p>ä»ä¸‹é¢ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ­¤å‡½æ•°æ˜¯å¯¹ <code>NewProductionConfig().Build(...)</code> å°è£…çš„å¿«æ·æ–¹å¼ã€‚</p>
<p><code>zap@v1.16.0 - logger.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewProduction</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Logger</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">NewProductionConfig</span><span class="p">().</span><span class="nf">Build</span><span class="p">(</span><span class="nx">options</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>NewProductionConfig</strong></p>
<p>åœ¨ InfoLevel åŠæ›´é«˜çº§åˆ«ä¸Šå¯ç”¨äº†æ—¥å¿—è®°å½•ã€‚å®ƒä½¿ç”¨ JSON ç¼–ç å™¨ï¼Œå†™å…¥ stderrï¼Œå¯ç”¨é‡‡æ ·ã€‚</p>
<p><code>zap@v1.16.0 - config.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewProductionConfig</span><span class="p">()</span> <span class="nx">Config</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">Config</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// info æ—¥å¿—çº§åˆ«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">Level</span><span class="p">:</span>       <span class="nf">NewAtomicLevelAt</span><span class="p">(</span><span class="nx">InfoLevel</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// éå¼€å‘æ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">Development</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é‡‡æ ·è®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">Sampling</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">SamplingConfig</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Initial</span><span class="p">:</span>    <span class="mi">100</span><span class="p">,</span> <span class="c1">// ç›¸åŒæ—¥å¿—çº§åˆ«ä¸‹ç›¸åŒå†…å®¹æ¯ç§’æ—¥å¿—è¾“å‡ºæ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">Thereafter</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// è¶…è¿‡è¯¥æ•°é‡ï¼Œæ‰ä¼šå†æ¬¡è¾“å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// JSON ç¼–ç å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">Encoding</span><span class="p">:</span>         <span class="s">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åé¢ä»‹ç»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncoderConfig</span><span class="p">:</span>    <span class="nf">NewProductionEncoderConfig</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡ºåˆ° stderr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">OutputPaths</span><span class="p">:</span>      <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;stderr&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ErrorOutputPaths</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;stderr&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Config</strong> ç»“æ„ä½“</p>
<p>é€šè¿‡ Config å¯ä»¥è®¾ç½®é€šç”¨çš„é…ç½®é¡¹ã€‚</p>
<p><code>zap@v1.16.0 - config.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Config</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ—¥å¿—çº§åˆ«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Level</span> <span class="nx">AtomicLevel</span> <span class="s">`json:&#34;level&#34; yaml:&#34;level&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å¼€å‘æ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Development</span> <span class="kt">bool</span> <span class="s">`json:&#34;development&#34; yaml:&#34;development&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åœæ­¢ä½¿ç”¨è°ƒç”¨æ–¹çš„å‡½æ•°å’Œè¡Œå·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">DisableCaller</span> <span class="kt">bool</span> <span class="s">`json:&#34;disableCaller&#34; yaml:&#34;disableCaller&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å®Œå…¨åœæ­¢ä½¿ç”¨å †æ ˆè·Ÿè¸ªï¼Œé»˜è®¤ä¸º  `&gt;=WarnLevel` ä½¿ç”¨å †æ ˆè·Ÿè¸ª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">DisableStacktrace</span> <span class="kt">bool</span> <span class="s">`json:&#34;disableStacktrace&#34; yaml:&#34;disableStacktrace&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é‡‡æ ·è®¾ç½®ç­–ç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Sampling</span> <span class="o">*</span><span class="nx">SamplingConfig</span> <span class="s">`json:&#34;sampling&#34; yaml:&#34;sampling&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®°å½•å™¨çš„ç¼–ç ï¼Œæœ‰æ•ˆå€¼ä¸º &#39;json&#39; å’Œ &#39;console&#39; ä»¥åŠé€šè¿‡ `RegisterEncoder` æ³¨å†Œçš„æœ‰æ•ˆç¼–ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Encoding</span> <span class="kt">string</span> <span class="s">`json:&#34;encoding&#34; yaml:&#34;encoding&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç¼–ç å™¨é€‰é¡¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">EncoderConfig</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span> <span class="s">`json:&#34;encoderConfig&#34; yaml:&#34;encoderConfig&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ—¥å¿—çš„è¾“å‡ºè·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">OutputPaths</span> <span class="p">[]</span><span class="kt">string</span> <span class="s">`json:&#34;outputPaths&#34; yaml:&#34;outputPaths&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// zap å†…éƒ¨é”™è¯¯çš„è¾“å‡ºè·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ErrorOutputPaths</span> <span class="p">[]</span><span class="kt">string</span> <span class="s">`json:&#34;errorOutputPaths&#34; yaml:&#34;errorOutputPaths&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ·»åŠ åˆ°æ ¹è®°å½•å™¨çš„å­—æ®µçš„é›†åˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">InitialFields</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span> <span class="s">`json:&#34;initialFields&#34; yaml:&#34;initialFields&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>NewDevelopment</strong></p>
<p>ä»ä¸‹é¢ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ­¤å‡½æ•°æ˜¯å¯¹ <code>NewDevelopmentConfig().Build(...)</code> å°è£…çš„å¿«æ·æ–¹å¼</p>
<p><code>zap@v1.16.0 - logger.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewDevelopment</span><span class="p">(</span><span class="nx">options</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Logger</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">NewDevelopmentConfig</span><span class="p">().</span><span class="nf">Build</span><span class="p">(</span><span class="nx">options</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>NewDevelopmentConfig</strong></p>
<p>æ­¤å‡½æ•°åœ¨ DebugLevel åŠæ›´é«˜ç‰ˆæœ¬ä¸Šå¯ç”¨æ—¥å¿—è®°å½•ï¼Œå®ƒä½¿ç”¨ console ç¼–ç å™¨ï¼Œå†™å…¥ stderrï¼Œç¦ç”¨é‡‡æ ·ã€‚</p>
<p><code>zap@v1.16.0 - config.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewDevelopmentConfig</span><span class="p">()</span> <span class="nx">Config</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">Config</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// debug ç­‰çº§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">Level</span><span class="p">:</span>            <span class="nf">NewAtomicLevelAt</span><span class="p">(</span><span class="nx">DebugLevel</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¼€å‘æ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">Development</span><span class="p">:</span>      <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// console ç¼–ç å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">Encoding</span><span class="p">:</span>         <span class="s">&#34;console&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">EncoderConfig</span><span class="p">:</span>    <span class="nf">NewDevelopmentEncoderConfig</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡ºåˆ° stderr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">OutputPaths</span><span class="p">:</span>      <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;stderr&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ErrorOutputPaths</span><span class="p">:</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;stderr&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>NewProductionEncoderConfig</code> å’Œ <code>NewDevelopmentEncoderConfig</code> éƒ½æ˜¯è¿”å›ç¼–ç å™¨é…ç½®ã€‚</p>
<p><code>zap@v1.16.0 - config.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">EncoderConfig</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® ç¼–ç ä¸º JSON æ—¶çš„ KEY
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// å¦‚æœä¸ºç©ºï¼Œåˆ™çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">MessageKey</span>    <span class="kt">string</span> <span class="s">`json:&#34;messageKey&#34; yaml:&#34;messageKey&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">LevelKey</span>      <span class="kt">string</span> <span class="s">`json:&#34;levelKey&#34; yaml:&#34;levelKey&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">TimeKey</span>       <span class="kt">string</span> <span class="s">`json:&#34;timeKey&#34; yaml:&#34;timeKey&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">NameKey</span>       <span class="kt">string</span> <span class="s">`json:&#34;nameKey&#34; yaml:&#34;nameKey&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">CallerKey</span>     <span class="kt">string</span> <span class="s">`json:&#34;callerKey&#34; yaml:&#34;callerKey&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">FunctionKey</span>   <span class="kt">string</span> <span class="s">`json:&#34;functionKey&#34; yaml:&#34;functionKey&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">StacktraceKey</span> <span class="kt">string</span> <span class="s">`json:&#34;stacktraceKey&#34; yaml:&#34;stacktraceKey&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// é…ç½®è¡Œåˆ†éš”ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">LineEnding</span>    <span class="kt">string</span> <span class="s">`json:&#34;lineEnding&#34; yaml:&#34;lineEnding&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é…ç½®å¸¸è§å¤æ‚ç±»å‹çš„åŸºæœ¬è¡¨ç¤ºå½¢å¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">EncodeLevel</span>    <span class="nx">LevelEncoder</span>    <span class="s">`json:&#34;levelEncoder&#34; yaml:&#34;levelEncoder&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">EncodeTime</span>     <span class="nx">TimeEncoder</span>     <span class="s">`json:&#34;timeEncoder&#34; yaml:&#34;timeEncoder&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">EncodeDuration</span> <span class="nx">DurationEncoder</span> <span class="s">`json:&#34;durationEncoder&#34; yaml:&#34;durationEncoder&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">EncodeCaller</span>   <span class="nx">CallerEncoder</span>   <span class="s">`json:&#34;callerEncoder&#34; yaml:&#34;callerEncoder&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ—¥å¿—åç§°ï¼Œæ­¤å‚æ•°å¯é€‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">EncodeName</span> <span class="nx">NameEncoder</span> <span class="s">`json:&#34;nameEncoder&#34; yaml:&#34;nameEncoder&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é…ç½® console ç¼–ç å™¨ä½¿ç”¨çš„å­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤ tab
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ConsoleSeparator</span> <span class="kt">string</span> <span class="s">`json:&#34;consoleSeparator&#34; yaml:&#34;consoleSeparator&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>NewProductionEncoderConfig</strong></p>
<p><code>zap@v1.16.0 - config.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewProductionEncoderConfig</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">TimeKey</span><span class="p">:</span>        <span class="s">&#34;ts&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">LevelKey</span><span class="p">:</span>       <span class="s">&#34;level&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">NameKey</span><span class="p">:</span>        <span class="s">&#34;logger&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">CallerKey</span><span class="p">:</span>      <span class="s">&#34;caller&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">FunctionKey</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">OmitKey</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MessageKey</span><span class="p">:</span>     <span class="s">&#34;msg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">StacktraceKey</span><span class="p">:</span>  <span class="s">&#34;stacktrace&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é»˜è®¤æ¢è¡Œç¬¦ \n
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">LineEnding</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DefaultLineEnding</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ—¥å¿—ç­‰çº§åºåˆ—ä¸ºå°å†™å­—ç¬¦ä¸²ï¼Œå¦‚:InfoLevelè¢«åºåˆ—åŒ–ä¸º &#34;info&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncodeLevel</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">LowercaseLevelEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ—¶é—´åºåˆ—åŒ–æˆæµ®ç‚¹ç§’æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncodeTime</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EpochTimeEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ—¶é—´åºåˆ—åŒ–ï¼ŒDurationä¸ºç»è¿‡çš„æµ®ç‚¹ç§’æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncodeDuration</span><span class="p">:</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">SecondsDurationEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä»¥ åŒ…å/æ–‡ä»¶å:è¡Œæ•° æ ¼å¼åºåˆ—åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncodeCaller</span><span class="p">:</span>   <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ShortCallerEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥é…ç½®ä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœï¼Œæ­¤ç»“æœå‡ºå¤„å‚è§ <strong>Example</strong> ä¸­çš„<a class="link" href="#example_1" >ä¾‹ä¸€</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;level&#34;</span>:<span class="s2">&#34;info&#34;</span>,<span class="s2">&#34;ts&#34;</span>:1620367988.461055,<span class="s2">&#34;caller&#34;</span>:<span class="s2">&#34;test/use_test.go:24&#34;</span>,<span class="s2">&#34;msg&#34;</span>:<span class="s2">&#34;Failed to fetch URL: https://baidu.com&#34;</span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>NewDevelopmentEncoderConfig</strong></p>
<p><code>zap@v1.16.0 - config.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewDevelopmentEncoderConfig</span><span class="p">()</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">EncoderConfig</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// keys å€¼å¯ä»¥æ˜¯ä»»æ„éç©ºçš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">TimeKey</span><span class="p">:</span>        <span class="s">&#34;T&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">LevelKey</span><span class="p">:</span>       <span class="s">&#34;L&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">NameKey</span><span class="p">:</span>        <span class="s">&#34;N&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">CallerKey</span><span class="p">:</span>      <span class="s">&#34;C&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">FunctionKey</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">OmitKey</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">MessageKey</span><span class="p">:</span>     <span class="s">&#34;M&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">StacktraceKey</span><span class="p">:</span>  <span class="s">&#34;S&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// é»˜è®¤æ¢è¡Œç¬¦ \n
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">LineEnding</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DefaultLineEnding</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ—¥å¿—ç­‰çº§åºåˆ—ä¸ºå¤§å†™å­—ç¬¦ä¸²ï¼Œå¦‚:InfoLevelè¢«åºåˆ—åŒ–ä¸º &#34;INFO&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncodeLevel</span><span class="p">:</span>    <span class="nx">zapcore</span><span class="p">.</span><span class="nx">CapitalLevelEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ—¶é—´æ ¼å¼åŒ–ä¸º  ISO8601 æ ¼å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncodeTime</span><span class="p">:</span>     <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ISO8601TimeEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">EncodeDuration</span><span class="p">:</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">StringDurationEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// // ä»¥ åŒ…å/æ–‡ä»¶å:è¡Œæ•° æ ¼å¼åºåˆ—åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">EncodeCaller</span><span class="p">:</span>   <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ShortCallerEncoder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥é…ç½®ä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœï¼Œæ­¤ç»“æœå‡ºå¤„å‚è§ Example ä¸­çš„ <!-- raw HTML omitted -->ä¾‹äºŒ<!-- raw HTML omitted --></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">2021-05-07T14:14:12.434+0800	INFO	test/use_test.go:31	failed to fetch URL	<span class="o">{</span><span class="s2">&#34;url&#34;</span>: <span class="s2">&#34;https://baidu.com&#34;</span>, <span class="s2">&#34;attempt&#34;</span>: 3, <span class="s2">&#34;backoff&#34;</span>: <span class="s2">&#34;1s&#34;</span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>NewProductionConfig</code> å’Œ <code>NewDevelopmentConfig</code> è¿”å› config è°ƒç”¨ <code>Build</code> å‡½æ•°è¿”å› loggerï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå‡½æ•°ã€‚</p>
<p><code>zap@v1.16.0 - config.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">cfg</span> <span class="nx">Config</span><span class="p">)</span> <span class="nf">Build</span><span class="p">(</span><span class="nx">opts</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Logger</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">enc</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nf">buildEncoder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">sink</span><span class="p">,</span> <span class="nx">errSink</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cfg</span><span class="p">.</span><span class="nf">openSinks</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">Level</span> <span class="o">==</span> <span class="p">(</span><span class="nx">AtomicLevel</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;missing Level&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nx">log</span> <span class="o">:=</span> <span class="nf">New</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span><span class="nx">enc</span><span class="p">,</span> <span class="nx">sink</span><span class="p">,</span> <span class="nx">cfg</span><span class="p">.</span><span class="nx">Level</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">cfg</span><span class="p">.</span><span class="nf">buildOptions</span><span class="p">(</span><span class="nx">errSink</span><span class="p">)</span><span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">log</span> <span class="p">=</span> <span class="nx">log</span><span class="p">.</span><span class="nf">WithOptions</span><span class="p">(</span><span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">log</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé€šè¿‡è§£æ config çš„å‚æ•°ï¼Œè°ƒç”¨ <code>New</code> æ–¹æ³•æ¥åˆ›å»º Loggerã€‚åœ¨ <strong>Example</strong> ä¸­<!-- raw HTML omitted -->ä¾‹å››<!-- raw HTML omitted -->ï¼Œå°±æ˜¯è°ƒç”¨ <code>New</code> æ–¹æ³•æ¥è‡ªå®šä¹‰ Loggerã€‚</p>
<h4 id="sugaredlogger">SugaredLogger</h4>
<p><code>Logger</code> ä½œä¸º <code>SugaredLogger</code> çš„å±æ€§ï¼Œè¿™ä¸ªå°è£…ä¼˜ç‚¹åœ¨äºä¸æ˜¯å¾ˆåœ¨ä¹æ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¿«é€Ÿè°ƒç”¨<code>Logger</code>ã€‚æ‰€ä»¥åå­—ä¸ºåŠ äº†ç³–çš„ Loggerã€‚</p>
<p><code>zap@v1.16.0 - logger.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SugaredLogger</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">base</span> <span class="o">*</span><span class="nx">Logger</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">zap</span><span class="p">.</span><span class="nf">ReplaceGlobals</span><span class="p">(</span><span class="nx">logger</span><span class="p">)</span>			<span class="c1">// é‡æ–°é…ç½®å…¨å±€å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">zap</span><span class="p">.</span><span class="nf">S</span><span class="p">().</span><span class="nf">Info</span><span class="p">(</span><span class="s">&#34;SugaredLogger&#34;</span><span class="p">)</span>   <span class="c1">// S è¿”å›å…¨å±€ SugaredLogger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">zap</span><span class="p">.</span><span class="nf">L</span><span class="p">().</span><span class="nf">Info</span><span class="p">(</span><span class="s">&#34;logger&#34;</span><span class="p">)</span>				  <span class="c1">// L è¿”å›å…¨å±€ logger
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸<code>Logger</code>ä¸åŒï¼Œ<code>SugaredLogger</code>ä¸å¼ºåˆ¶æ—¥å¿—ç»“æ„åŒ–ã€‚æ‰€ä»¥å¯¹äºæ¯ä¸ªæ—¥å¿—çº§åˆ«ï¼Œéƒ½æä¾›äº†ä¸‰ç§æ–¹æ³•ã€‚</p>
<p><img src="http://img.golang.space/shot-1621394160652.png"
	
	
	
	loading="lazy"
	
		alt="level"
	
	
></p>
<p><code>zap@v1.16.0 - sugar.go</code></p>
<p>ä»¥ info çº§åˆ«ä¸ºä¾‹ï¼Œç›¸å…³çš„ä¸‰ç§æ–¹æ³•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Info ä½¿ç”¨ fmt.Sprint æ„é€ å’Œè®°å½•æ¶ˆæ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">SugaredLogger</span><span class="p">)</span> <span class="nf">Info</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">InfoLevel</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Infof ä½¿ç”¨ fmt.Sprintf è®°å½•æ¨¡æ¿æ¶ˆæ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">SugaredLogger</span><span class="p">)</span> <span class="nf">Infof</span><span class="p">(</span><span class="nx">template</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">InfoLevel</span><span class="p">,</span> <span class="nx">template</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Infow è®°å½•å¸¦æœ‰å…¶ä»–ä¸Šä¸‹æ–‡çš„æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">SugaredLogger</span><span class="p">)</span> <span class="nf">Infow</span><span class="p">(</span><span class="nx">msg</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">keysAndValues</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">s</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">InfoLevel</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">keysAndValues</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>sugar.Infof(&quot;...&quot;)</code> æ‰“ä¸Šæ–­ç‚¹ï¼Œä»è¿™å¼€å§‹è¿½è¸ªæºç ã€‚</p>
<p><img src="http://img.golang.space/shot-1621393972465.png"
	
	
	
	loading="lazy"
	
		alt="image-20210519111252185"
	
	
></p>
<p>åœ¨è°ƒè¯•ä»£ç ä¹‹å‰ï¼Œå…ˆç»™å¤§å®¶çœ‹ä¸€ä¸‹<code>SugaredLogger</code> çš„  <code>Infof</code> å‡½æ•°çš„è°ƒç”¨çš„å¤§è‡´å·¥ä½œæµï¼Œå…¶ä¸­ä¸æ¶‰åŠé‡‡æ ·ç­‰ã€‚</p>
<p><img src="http://img.golang.space/shot-1622542093397.png"
	
	
	
	loading="lazy"
	
		alt="infofå·¥ä½œæµç¨‹"
	
	
></p>
<p><code>Info</code> , <code>Infof</code>, <code>Infow</code> ä¸‰ä¸ªå‡½æ•°éƒ½è°ƒç”¨äº† <code>log</code> å‡½æ•°ï¼Œ<code>log</code> å‡½æ•°ä»£ç å¦‚ä¸‹</p>
<p><code>zap@v1.16.0 - sugar.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">SugaredLogger</span><span class="p">)</span> <span class="nf">log</span><span class="p">(</span><span class="nx">lvl</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">Level</span><span class="p">,</span> <span class="nx">template</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">fmtArgs</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">context</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åˆ¤æ–­æ˜¯å¦å¯ç”¨çš„æ—¥å¿—çº§åˆ«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">lvl</span> <span class="p">&lt;</span> <span class="nx">DPanicLevel</span> <span class="o">&amp;&amp;</span> <span class="p">!</span><span class="nx">s</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nf">Core</span><span class="p">().</span><span class="nf">Enabled</span><span class="p">(</span><span class="nx">lvl</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å°†å‚æ•°åˆå¹¶åˆ°è¯­å¥ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">msg</span> <span class="o">:=</span> <span class="nf">getMessage</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">fmtArgs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Check å¯ä»¥å¸®åŠ©é¿å…åˆ†é…ä¸€ä¸ªåˆ†ç‰‡æ¥ä¿å­˜å­—æ®µã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">ce</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="nx">lvl</span><span class="p">,</span> <span class="nx">msg</span><span class="p">);</span> <span class="nx">ce</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ce</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nf">sweetenFields</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•° <code>InfoLevel</code> æ˜¯æ—¥å¿—çº§åˆ«ï¼Œå…¶æºç å¦‚ä¸‹</p>
<p><code>zap@v1.16.0 - zapcore/level.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Debug åº”æ˜¯å¤§é‡çš„ï¼Œä¸”é€šå¸¸åœ¨ç”Ÿäº§çŠ¶æ€ç¦ç”¨.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">DebugLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DebugLevel</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Info æ˜¯é»˜è®¤çš„è®°å½•ä¼˜å…ˆçº§.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">InfoLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">InfoLevel</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Warn æ¯” info æ›´é‡è¦.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">WarnLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">WarnLevel</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Error æ˜¯é«˜ä¼˜å…ˆçº§çš„,å¦‚æœç¨‹åºé¡ºåˆ©ä¸åº”è¯¥äº§ç”Ÿä»»ä½• err çº§åˆ«æ—¥å¿—.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ErrorLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">ErrorLevel</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// DPanic ç‰¹åˆ«é‡å¤§çš„é”™è¯¯ï¼Œåœ¨å¼€å‘æ¨¡å¼ä¸‹å¼•èµ· panic. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">DPanicLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">DPanicLevel</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Panic è®°å½•æ¶ˆæ¯åè°ƒç”¨ panic.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">PanicLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">PanicLevel</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Fatal è®°å½•æ¶ˆæ¯åè°ƒç”¨ os.Exit(1).
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">FatalLevel</span> <span class="p">=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nx">FatalLevel</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>getMessage</code> å‡½æ•°å¤„ç† <code>template</code> å’Œ <code>fmtArgs</code> å‚æ•°ï¼Œä¸»è¦ä¸ºä¸åŒçš„å‚æ•°é€‰æ‹©æœ€åˆé€‚çš„æ–¹å¼æ‹¼æ¥æ¶ˆæ¯</p>
<p><code>zap@v1.16.0 - sugar.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">getMessage</span><span class="p">(</span><span class="nx">template</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">fmtArgs</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{})</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ²¡æœ‰å‚æ•°ç›´æ¥è¿”å› template
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">fmtArgs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">template</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">  <span class="c1">// æ­¤å¤„è°ƒç”¨ Sprintf ä¼šä½¿ç”¨åå°„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">template</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">fmtArgs</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">  <span class="c1">// æ¶ˆæ¯ä¸ºç©ºå¹¶ä¸”æœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›è¯¥å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">fmtArgs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">fmtArgs</span><span class="p">[</span><span class="mi">0</span><span class="p">].(</span><span class="kt">string</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nx">str</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// è¿”å›æ‰€æœ‰ fmtArgs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprint</span><span class="p">(</span><span class="nx">fmtArgs</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…³äº <code>s.base.Check</code> ï¼Œè¿™å°±éœ€è¦ä»‹ç»<code>zapcore</code> ï¼Œä¸‹é¢åˆ†æç›¸å…³æ¨¡å—ã€‚</p>
<h4 id="zapcore">zapcore</h4>
<p><code>zapcore</code>åŒ… å®šä¹‰å¹¶å®ç°äº†æ„å»º zap çš„ä½çº§æ¥å£ã€‚é€šè¿‡æä¾›è¿™äº›æ¥å£çš„æ›¿ä»£å®ç°ï¼Œå¤–éƒ¨åŒ…å¯ä»¥æ‰©å±• zap çš„åŠŸèƒ½ã€‚</p>
<p><code>zap@v1.16.0 - zapcore/core.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Core æ˜¯ä¸€ä¸ªæœ€å°çš„ã€å¿«é€Ÿçš„è®°å½•å™¨æ¥å£ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Core</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ¥å£ï¼Œå†³å®šä¸€ä¸ªæ—¥å¿—ç­‰çº§æ˜¯å¦å¯ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">LevelEnabler</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å‘ core æ·»åŠ æ ¸å¿ƒä¸Šä¸‹æ–‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">With</span><span class="p">([]</span><span class="nx">Field</span><span class="p">)</span> <span class="nx">Core</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ£€æŸ¥æ˜¯å¦åº”è®°å½•æä¾›çš„æ¡ç›®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// åœ¨è°ƒç”¨ write ä¹‹å‰å¿…é¡»å…ˆè°ƒç”¨ Check
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">Check</span><span class="p">(</span><span class="nx">Entry</span><span class="p">,</span> <span class="o">*</span><span class="nx">CheckedEntry</span><span class="p">)</span> <span class="o">*</span><span class="nx">CheckedEntry</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å†™å…¥æ—¥å¿—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">Write</span><span class="p">(</span><span class="nx">Entry</span><span class="p">,</span> <span class="p">[]</span><span class="nx">Field</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// åŒæ­¥åˆ·æ–°ç¼“å­˜æ—¥å¿—(å¦‚æœæœ‰)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">Sync</span><span class="p">()</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Check</code> å‡½æ•°æœ‰ä¸¤ä¸ªå…¥å‚ã€‚ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¸€æ¡å®Œæ•´çš„æ—¥å¿—æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º nil æ—¶ä¼šä» <code>sync.Pool</code> åˆ›å»ºçš„æ± ä¸­å–å‡º<code>*CheckedEntry </code>å¯¹è±¡å¤ç”¨ï¼Œé¿å…é‡æ–°åˆ†é…å†…å­˜ã€‚è¯¥å‡½æ•°å†…éƒ¨è°ƒç”¨ <code>AddCore</code> å®ç°è·å– <code>*CheckedEntry</code>å¯¹è±¡ï¼Œæœ€åè°ƒç”¨ <code>Write</code> å†™å…¥æ—¥å¿—æ¶ˆæ¯ã€‚</p>
<p>ç›¸å…³ä»£ç å…¨éƒ¨è´´åœ¨ä¸‹é¢ï¼Œæ›´å¤šä»‹ç»è¯·çœ‹ä»£ç ä¸­çš„æ³¨é‡Šã€‚</p>
<p><code>zap@v1.16.0 - zapcore/entry.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ä¸€ä¸ª entry è¡¨ç¤ºä¸€ä¸ªå®Œæ•´çš„æ—¥å¿—æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Entry</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Level</span>      <span class="nx">Level</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Time</span>       <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
</span></span><span class="line"><span class="cl">	<span class="nx">LoggerName</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Message</span>    <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Caller</span>     <span class="nx">EntryCaller</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Stack</span>      <span class="kt">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨ sync.Pool å¤ç”¨ä¸´æ—¶å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_cePool</span> <span class="p">=</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Pool</span><span class="p">{</span><span class="nx">New</span><span class="p">:</span> <span class="kd">func</span><span class="p">()</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">&amp;</span><span class="nx">CheckedEntry</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">cores</span><span class="p">:</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">Core</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä»æ± ä¸­å–å‡º CheckedEntry å¹¶åˆå§‹åŒ–å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">getCheckedEntry</span><span class="p">()</span> <span class="o">*</span><span class="nx">CheckedEntry</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span> <span class="o">:=</span> <span class="nx">_cePool</span><span class="p">.</span><span class="nf">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">CheckedEntry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nf">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">ce</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// CheckedEntry æ˜¯ enter å’Œ cores é›†åˆã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">CheckedEntry</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Entry</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ErrorOutput</span> <span class="nx">WriteSyncer</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dirty</span>       <span class="kt">bool</span>  <span class="c1">// ç”¨äºæ£€æµ‹æ˜¯å¦é‡å¤ä½¿ç”¨å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">should</span>      <span class="nx">CheckWriteAction</span> <span class="c1">// ç»“æŸç¨‹åºçš„åŠ¨ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">cores</span>       <span class="p">[]</span><span class="nx">Core</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é‡ç½®å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">ce</span> <span class="o">*</span><span class="nx">CheckedEntry</span><span class="p">)</span> <span class="nf">reset</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nx">Entry</span> <span class="p">=</span> <span class="nx">Entry</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nx">ErrorOutput</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nx">dirty</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nx">should</span> <span class="p">=</span> <span class="nx">WriteThenNoop</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ä¸è¦ä¿ç•™å¯¹ core çš„å¼•ç”¨!!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span> <span class="p">=</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å°† entry å†™å…¥å­˜å‚¨çš„ cores
</span></span></span><span class="line"><span class="cl"><span class="c1">// æœ€åå°† CheckedEntry æ·»åŠ åˆ°æ± ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">ce</span> <span class="o">*</span><span class="nx">CheckedEntry</span><span class="p">)</span> <span class="nf">Write</span><span class="p">(</span><span class="nx">fields</span> <span class="o">...</span><span class="nx">Field</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ce</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">dirty</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">ErrorOutput</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// æ£€æŸ¥ CheckedEntry çš„ä¸å®‰å…¨é‡å¤ä½¿ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">ErrorOutput</span><span class="p">,</span> <span class="s">&#34;%v Unsafe CheckedEntry re-use near Entry %+v.\n&#34;</span><span class="p">,</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">Entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ce</span><span class="p">.</span><span class="nx">ErrorOutput</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nx">dirty</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl"> 	<span class="c1">// å†™å…¥æ—¥å¿—æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="p">=</span> <span class="nx">multierr</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nf">Write</span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">Entry</span><span class="p">,</span> <span class="nx">fields</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å¤„ç†å†…éƒ¨å‘ç”Ÿçš„é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">ErrorOutput</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">ErrorOutput</span><span class="p">,</span> <span class="s">&#34;%v write error: %v\n&#34;</span><span class="p">,</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="nx">ce</span><span class="p">.</span><span class="nx">ErrorOutput</span><span class="p">.</span><span class="nf">Sync</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">should</span><span class="p">,</span> <span class="nx">msg</span> <span class="o">:=</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">should</span><span class="p">,</span> <span class="nx">ce</span><span class="p">.</span><span class="nx">Message</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å°† CheckedEntry æ·»åŠ åˆ°æ± ä¸­ï¼Œä¸‹æ¬¡å¤ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">putCheckedEntry</span><span class="p">(</span><span class="nx">ce</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">  <span class="c1">// åˆ¤æ–­æ˜¯å¦éœ€è¦ panic æˆ–å…¶å®ƒæ–¹å¼ç»ˆæ­¢ç¨‹åº..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">switch</span> <span class="nx">should</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="nx">WriteThenPanic</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="nx">WriteThenFatal</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nx">exit</span><span class="p">.</span><span class="nf">Exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="nx">WriteThenGoexit</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="nx">runtime</span><span class="p">.</span><span class="nf">Goexit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">ce</span> <span class="o">*</span><span class="nx">CheckedEntry</span><span class="p">)</span> <span class="nf">AddCore</span><span class="p">(</span><span class="nx">ent</span> <span class="nx">Entry</span><span class="p">,</span> <span class="nx">core</span> <span class="nx">Core</span><span class="p">)</span> <span class="o">*</span><span class="nx">CheckedEntry</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">ce</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä»æ± ä¸­å– CheckedEntryï¼Œå‡å°‘å†…å­˜åˆ†é…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">ce</span> <span class="p">=</span> <span class="nf">getCheckedEntry</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ce</span><span class="p">.</span><span class="nx">Entry</span> <span class="p">=</span> <span class="nx">ent</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">ce</span><span class="p">.</span><span class="nx">cores</span><span class="p">,</span> <span class="nx">core</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">ce</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="doc">Doc</h2>
<p><a class="link" href="https://pkg.go.dev/go.uber.org/zap"  target="_blank" rel="noopener"
    >https://pkg.go.dev/go.uber.org/zap</a></p>
<h2 id="qa">QA</h2>
<h3 id="è®¾è®¡é—®é¢˜">è®¾è®¡é—®é¢˜</h3>
<h4 id="ä¸ºä»€ä¹ˆè¦åœ¨loggeræ€§èƒ½ä¸ŠèŠ±è´¹è¿™ä¹ˆå¤šç²¾åŠ›å‘¢">ä¸ºä»€ä¹ˆè¦åœ¨Loggeræ€§èƒ½ä¸ŠèŠ±è´¹è¿™ä¹ˆå¤šç²¾åŠ›å‘¢ï¼Ÿ</h4>
<p>å½“ç„¶ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸ä¼šæ³¨æ„åˆ°Loggeræ…¢çš„å½±å“ï¼šå› ä¸ºå®ƒä»¬æ¯æ¬¡æ“ä½œä¼šéœ€è¦å‡ åæˆ–å‡ ç™¾æ¯«ç§’ï¼Œæ‰€ä»¥é¢å¤–çš„å‡ æ¯«ç§’å¾ˆæ— å…³ç´§è¦ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—å¿«é€Ÿå¼€å‘å‘¢ï¼Ÿä¸å…¶ä»–æ—¥å¿—åŒ…ç›¸æ¯”<code>SugaredLogger</code>çš„ä½¿ç”¨å¹¶ä¸éš¾ï¼Œ<code>Logger</code>ä½¿ç»“æ„åŒ–è®°å½•åœ¨å¯¹æ€§èƒ½è¦æ±‚ä¸¥æ ¼çš„ç¯å¢ƒä¸­æˆä¸ºå¯èƒ½ã€‚åœ¨ Go å¾®æœåŠ¡çš„æ¶æ„ä½“ç³»ä¸­ï¼Œä½¿æ¯ä¸ªåº”ç”¨ç¨‹åºç”šè‡³ç¨å¾®æ›´æœ‰æ•ˆåœ°åŠ é€Ÿæ‰§è¡Œã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆæ²¡æœ‰loggerå’Œsugaredloggeræ¥å£">ä¸ºä»€ä¹ˆæ²¡æœ‰<code>Logger</code>å’Œ<code>SugaredLogger</code>æ¥å£ï¼Ÿ</h4>
<p>ä¸åƒç†Ÿæ‚‰çš„<code>io.Writer</code>å’Œ<code>http.Handler</code>ã€<code>Logger</code>å’Œ<code>SugaredLogger</code>æ¥å£å°†åŒ…æ‹¬<strong>å¾ˆå¤š</strong>æ–¹æ³•ã€‚æ­£å¦‚ <a class="link" href="https://go-proverbs.github.io/"  target="_blank" rel="noopener"
    >Rob Pike è°šè¯­æŒ‡å‡º</a>çš„ï¼Œ&ldquo;The bigger the interface, the weaker the abstraction&rdquo;(æ¥å£è¶Šå¤§ï¼ŒæŠ½è±¡è¶Šå¼±)ã€‚æ¥å£ä¹Ÿæ˜¯ä¸¥æ ¼çš„ï¼Œä»»ä½•æ›´æ”¹éƒ½éœ€è¦å‘å¸ƒä¸€ä¸ªæ–°çš„ä¸»ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒæ‰“ç ´äº†æ‰€æœ‰ç¬¬ä¸‰æ–¹å®ç°ã€‚</p>
<p><code>Logger</code>å’Œ<code>SugaredLogger</code>æˆä¸ºå…·ä½“ç±»å‹å¹¶ä¸ä¼šç‰ºç‰²å¤ªå¤šæŠ½è±¡ï¼Œè€Œä¸”å®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸å¼•å…¥ç ´åæ€§æ›´æ”¹çš„æƒ…å†µä¸‹æ·»åŠ æ–¹æ³•ã€‚æ‚¨çš„åº”ç”¨ç¨‹åºåº”è¯¥å®šä¹‰å¹¶ä¾èµ–åªåŒ…å«æ‚¨ä½¿ç”¨çš„æ–¹æ³•çš„æ¥å£ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆæˆ‘çš„ä¸€äº›æ—¥å¿—ä¼šä¸¢å¤±">ä¸ºä»€ä¹ˆæˆ‘çš„ä¸€äº›æ—¥å¿—ä¼šä¸¢å¤±ï¼Ÿ</h4>
<p>åœ¨å¯ç”¨æŠ½æ ·æ—¶ï¼Œé€šè¿‡zapæœ‰æ„åœ°åˆ é™¤æ—¥å¿—ã€‚ç”Ÿäº§é…ç½®(å¦‚NewProductionConfig()è¿”å›çš„é‚£æ ·)æ”¯æŒæŠ½æ ·ï¼Œè¿™å°†å¯¼è‡´åœ¨ä¸€ç§’é’Ÿå†…å¯¹é‡å¤æ—¥å¿—è¿›è¡ŒæŠ½æ ·ã€‚æœ‰å…³ä¸ºä»€ä¹ˆå¯ç”¨æŠ½æ ·çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a class="link" href="https://github.com/uber-go/zap/blob/master/FAQ.md#why-sample-application-logs"  target="_blank" rel="noopener"
    >&ldquo;ä¸ºä»€ä¹ˆä½¿ç”¨ç¤ºä¾‹åº”ç”¨æ—¥å¿—&quot;ä¸­å¯ç”¨é‡‡æ ·</a>.</p>
<h4 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¤ºä¾‹åº”ç”¨ç¨‹åºæ—¥å¿—">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¤ºä¾‹åº”ç”¨ç¨‹åºæ—¥å¿—ï¼Ÿ</h4>
<p>åº”ç”¨ç¨‹åºç»å¸¸ä¼šé‡åˆ°é”™è¯¯ï¼Œæ— è®ºæ˜¯å› ä¸ºé”™è¯¯è¿˜æ˜¯å› ä¸ºç”¨æˆ·ä½¿ç”¨é”™è¯¯ã€‚è®°å½•é”™è¯¯æ—¥å¿—é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä½†å®ƒå¾ˆå®¹æ˜“ä½¿è¿™ç§ç³Ÿç³•çš„æƒ…å†µå˜å¾—æ›´ç³Ÿï¼šä¸ä»…æ‚¨çš„åº”ç”¨ç¨‹åºåº”å¯¹å¤§é‡é”™è¯¯ï¼Œå®ƒè¿˜èŠ±è´¹é¢å¤–çš„CPUå‘¨æœŸå’ŒI/Oè®°å½•è¿™äº›é”™è¯¯æ—¥å¿—ã€‚ç”±äºå†™å…¥é€šå¸¸æ˜¯åºåˆ—åŒ–çš„ï¼Œå› æ­¤åœ¨æœ€éœ€è¦æ—¶ï¼Œ<code>logger</code>ä¼šé™åˆ¶ååé‡ã€‚</p>
<p>é‡‡æ ·é€šè¿‡åˆ é™¤é‡å¤çš„æ—¥å¿—æ¡ç›®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºä¼šè¾“å‡ºæ¯ä¸ªè®°å½•ã€‚ä½†æ˜¯ï¼Œå½“ç±»ä¼¼çš„è®°å½•æ¯ç§’è¾“å‡ºæ•°ç™¾æˆ–æ•°åƒæ¬¡æ—¶ï¼Œzap å¼€å§‹ä¸¢å¼ƒé‡å¤ä»¥ä¿å­˜ååé‡ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆç»“æ„åŒ–çš„æ—¥å¿—-api-é™¤äº†æ¥å—å­—æ®µä¹‹å¤–è¿˜å¯ä»¥æ¥æ”¶æ¶ˆæ¯">ä¸ºä»€ä¹ˆç»“æ„åŒ–çš„æ—¥å¿— API é™¤äº†æ¥å—å­—æ®µä¹‹å¤–è¿˜å¯ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Ÿ</h4>
<p>ä¸»è§‚ä¸Šï¼Œæˆ‘ä»¬å‘ç°åœ¨ç»“æ„åŒ–ä¸Šä¸‹æ–‡ä¸­é™„å¸¦ä¸€ä¸ªç®€çŸ­çš„æè¿°æ˜¯æœ‰å¸®åŠ©çš„ã€‚è¿™åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¹¶ä¸å…³é”®ï¼Œä½†å®ƒä½¿è°ƒè¯•å’Œæ“ä½œä¸ç†Ÿæ‚‰çš„ç³»ç»Ÿæ›´åŠ å®¹æ˜“ã€‚</p>
<p>æ›´å…·ä½“åœ°è¯´ï¼Œzap çš„é‡‡æ ·ç®—æ³•ä½¿ç”¨æ¶ˆæ¯æ¥è¯†åˆ«é‡å¤çš„æ¡ç›®ã€‚æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œè¿™æ˜¯ä¸€ä¸ªä»‹äºéšæœºæŠ½æ ·ï¼ˆé€šå¸¸åœ¨è°ƒè¯•æ—¶åˆ é™¤æ‚¨éœ€è¦çš„ç¡®åˆ‡æ¡ç›®ï¼‰å’Œå“ˆå¸Œå®Œæ•´æ¡ç›®ï¼ˆä»£ä»·é«˜ï¼‰ä¹‹é—´çš„ä¸€ä¸ªä¸­é—´æ–¹æ³•ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦åŒ…æ‹¬å…¨å±€-loggers">ä¸ºä»€ä¹ˆè¦åŒ…æ‹¬å…¨å±€ loggersï¼Ÿ</h4>
<p>ç”±äºè®¸å¤šå…¶ä»–æ—¥å¿—åŒ…éƒ½åŒ…å«å…¨å±€å˜é‡loggerï¼Œè®¸å¤šåº”ç”¨ç¨‹åºæ²¡æœ‰è®¾è®¡æˆæ¥æ”¶loggerä½œä¸ºæ˜¾å¼å‚æ•°ã€‚æ›´æ”¹å‡½æ•°ç­¾åé€šå¸¸æ˜¯ä¸€ç§ç ´åæ€§çš„æ›´æ”¹ï¼Œå› æ­¤zapåŒ…å«å…¨å±€loggerä»¥ç®€åŒ–è¿ç§»ã€‚</p>
<p>å°½å¯èƒ½é¿å…ä½¿ç”¨å®ƒä»¬ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆåŒ…æ‹¬ä¸“ç”¨çš„panicå’Œfatalæ—¥å¿—çº§åˆ«">ä¸ºä»€ä¹ˆåŒ…æ‹¬ä¸“ç”¨çš„Panicå’ŒFatalæ—¥å¿—çº§åˆ«ï¼Ÿ</h4>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºä»£ç åº”ä¼˜é›…åœ°å¤„ç†é”™è¯¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨<code>panic</code>æˆ–<code>os.Exit</code>ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªè§„åˆ™éƒ½æœ‰ä¾‹å¤–ï¼Œå½“é”™è¯¯ç¡®å®æ— æ³•æ¢å¤æ—¶ï¼Œå´©æºƒæ˜¯å¾ˆå¸¸è§çš„ã€‚ä¸ºäº†é¿å…ä¸¢å¤±ä»»ä½•ä¿¡æ¯ï¼ˆå°¤å…¶æ˜¯å´©æºƒçš„åŸå› ï¼‰ï¼Œè®°å½•å™¨å¿…é¡»åœ¨è¿›ç¨‹é€€å‡ºä¹‹å‰å†²æ´—ä»»ä½•ç¼“å†²æ¡ç›®ã€‚</p>
<p>Zap é€šè¿‡æä¾›åœ¨é€€å‡ºå‰è‡ªåŠ¨å†²æ´—çš„<code>Panic</code>å’Œ<code>Fatal</code>è®°å½•æ–¹æ³•æ¥ä½¿è¿™ä¸€æ“ä½œå˜å¾—ç®€å•ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸ä¿è¯æ—¥å¿—æ°¸è¿œä¸ä¼šä¸¢å¤±ï¼Œä½†å®ƒæ¶ˆé™¤äº†å¸¸è§çš„é”™è¯¯ã€‚</p>
<p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Uber-go/zap#207 ä¸­çš„è®¨è®ºã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯dpanic">ä»€ä¹ˆæ˜¯<code>DPanic</code>?</h4>
<p><code>DPanic</code>ä»£è¡¨&quot;panic in development.&quot;ã€‚åœ¨developmentä¸­ï¼Œå®ƒä¼šæ‰“å°Panicçº§åˆ«çš„æ—¥å¿—ï¼šåä¹‹ï¼Œå®ƒå°†å‘ç”Ÿåœ¨Errorçº§åˆ«çš„æ—¥å¿—ï¼Œ<code>DPanic</code>æ›´åŠ å®¹æ˜“æ•è·å¯èƒ½ä½†å®é™…ä¸Šä¸åº”è¯¥å‘ç”Ÿçš„é”™è¯¯ï¼Œè€Œä¸æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­Panicã€‚</p>
<p>å¦‚æœä½ æ›¾ç»å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>DPanic</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;shouldn&#39;t ever get here: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…é—®é¢˜">å®‰è£…é—®é¢˜</h3>
<h4 id="é”™è¯¯expects-import-gouberorgzapæ˜¯ä»€ä¹ˆæ„æ€">é”™è¯¯<code>expects import &quot;go.uber.org/zap&quot;</code>æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h4>
<p>è¦ä¹ˆzapå®‰è£…é”™è¯¯ï¼Œè¦ä¹ˆæ‚¨å¼•ç”¨äº†ä»£ç ä¸­çš„é”™è¯¯åŒ…åã€‚</p>
<p>Zap çš„æºä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œä½†  <a class="link" href="https://golang.org/cmd/go/#hdr-Remote_import_paths"  target="_blank" rel="noopener"
    >import path</a>æ˜¯  <code>go.uber.org/zap</code>ï¼Œè®©æˆ‘ä»¬é¡¹ç›®ç»´æŠ¤è€…ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°è‡ªç”±ç§»åŠ¨æºä»£ç ã€‚æ‰€ä»¥åœ¨å®‰è£…å’Œä½¿ç”¨åŒ…æ—¶éœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ã€‚</p>
<p>å¦‚æœä½ éµå¾ªä¸¤ä¸ªç®€å•çš„è§„åˆ™ï¼Œå°±ä¼šæ­£å¸¸å·¥ä½œï¼šå®‰è£…zap<code>go get -u go.uber.org/zap</code>å¹¶å§‹ç»ˆå¯¼å…¥å®ƒåœ¨ä½ çš„ä»£ç <code>import &quot;go.uber.org/zap&quot;</code>ï¼Œä»£ç ä¸åº”åŒ…å«ä»»ä½•å¯¹<code>github.com/uber-go/zap</code>çš„å¼•ç”¨.</p>
<h3 id="ç”¨æ³•é—®é¢˜">ç”¨æ³•é—®é¢˜</h3>
<h4 id="zapæ˜¯å¦æ”¯æŒæ—¥å¿—åˆ‡å‰²">Zapæ˜¯å¦æ”¯æŒæ—¥å¿—åˆ‡å‰²ï¼Ÿ</h4>
<p>Zap ä¸æ”¯æŒåˆ‡å‰²æ—¥å¿—æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æ›´å–œæ¬¢å°†æ­¤äº¤ç»™å¤–éƒ¨ç¨‹åºï¼Œå¦‚<code>logrotate</code>.</p>
<p>ä½†æ˜¯ï¼Œæ—¥å¿—åˆ‡å‰²åŒ…å¾ˆå®¹æ˜“é›†æˆï¼Œå¦‚  <a class="link" href="https://godoc.org/gopkg.in/natefinch/lumberjack.v2"  target="_blank" rel="noopener"
    ><code>gopkg.in/natefinch/lumberjack.v2</code></a> ä½œä¸º<code>zapcore.WriteSyncer</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// lumberjack.Logger is already safe for concurrent use, so we don&#39;t need to
</span></span></span><span class="line"><span class="cl"><span class="c1">// lock it.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">w</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">AddSync</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Filename</span><span class="p">:</span>   <span class="s">&#34;/var/log/myapp/foo.log&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">MaxSize</span><span class="p">:</span>    <span class="mi">500</span><span class="p">,</span> <span class="c1">// megabytes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">MaxBackups</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">MaxAge</span><span class="p">:</span>     <span class="mi">28</span><span class="p">,</span> <span class="c1">// days
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nx">core</span> <span class="o">:=</span> <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewCore</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">zapcore</span><span class="p">.</span><span class="nf">NewJSONEncoder</span><span class="p">(</span><span class="nx">zap</span><span class="p">.</span><span class="nf">NewProductionEncoderConfig</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">w</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">zap</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">logger</span> <span class="o">:=</span> <span class="nx">zap</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">core</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ’ä»¶">æ’ä»¶</h4>
<p>æˆ‘ä»¬å¾ˆå¸Œæœ›zap æœ¬èº«èƒ½æ»¡è¶³çš„æ¯ä¸€ä¸ªloggingéœ€æ±‚ï¼Œä½†æˆ‘ä»¬åªç†Ÿæ‚‰å°‘æ•°æ—¥å¿—æ‘„å…¥(log ingestion)ç³»ç»Ÿã€å‚æ•°è§£æ(flag-parsing)åŒ…ç­‰ã€‚æ‰€ä»¥æˆ‘ä»¬æ›´æ„¿æ„å‘å±• zap æ’ä»¶ç”Ÿæ€ç³»ç»Ÿã€‚</p>
<p>ä¸‹é¢æ‰©å±•åŒ…ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒä½¿ç”¨ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>åŒ…</th>
<th>é›†æˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>github.com/tchap/zapext</code></td>
<td>Sentry, syslog</td>
</tr>
<tr>
<td><code>github.com/fgrosse/zaptest</code></td>
<td>Ginkgo</td>
</tr>
<tr>
<td><code>github.com/blendle/zapdriver</code></td>
<td>Stackdriver</td>
</tr>
<tr>
<td><code>github.com/moul/zapgorm</code></td>
<td>Gorm</td>
</tr>
</tbody>
</table></div>
<h3 id="æ€§èƒ½æ¯”è¾ƒ">æ€§èƒ½æ¯”è¾ƒ</h3>
<blockquote>
<p>è¯´æ˜ : ä»¥ä¸‹èµ„æ–™æ¥æºäº zap å®˜æ–¹ï¼ŒZap æä¾›çš„åŸºå‡†æµ‹è¯•æ¸…æ¥šåœ°è¡¨æ˜ï¼Œ<a class="link" href="https://github.com/rs/zerolog"  target="_blank" rel="noopener"
    >zerolog</a>æ˜¯ä¸ Zap ç«äº‰æœ€æ¿€çƒˆçš„ã€‚zeroloè¿˜æä¾›ç»“æœéå¸¸ç›¸ä¼¼çš„<a class="link" href="https://github.com/rs/zerolog#benchmarks"  target="_blank" rel="noopener"
    >åŸºå‡†æµ‹è¯•</a>ï¼š</p>
</blockquote>
<p>è®°å½•ä¸€ä¸ª10ä¸ªkvå­—æ®µçš„æ¶ˆæ¯ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>åº“å</th>
<th>æ¯æ¬¡è¿­ä»£è€—æ—¶</th>
<th>è€—æ—¶ç›¸æ¯”zap</th>
<th>æ¯æ¬¡è¿­ä»£å†…å­˜åˆ†é…æ¬¡æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>âš¡ zap</td>
<td>862 ns/op</td>
<td>+0%</td>
<td>5 allocs/op</td>
</tr>
<tr>
<td>âš¡ zap (sugared)</td>
<td>1250 ns/op</td>
<td>+45%</td>
<td>11 allocs/op</td>
</tr>
<tr>
<td>zerolog</td>
<td>4021 ns/op</td>
<td>+366%</td>
<td>76 allocs/op</td>
</tr>
<tr>
<td>go-kit</td>
<td>4542 ns/op</td>
<td>+427%</td>
<td>105 allocs/op</td>
</tr>
<tr>
<td>apex/log</td>
<td>26785 ns/op</td>
<td>+3007%</td>
<td>115 allocs/op</td>
</tr>
<tr>
<td>logrus</td>
<td>29501 ns/op</td>
<td>+3322%</td>
<td>125 allocs/op</td>
</tr>
<tr>
<td>log15</td>
<td>29906 ns/op</td>
<td>+3369%</td>
<td>122 allocs/op</td>
</tr>
</tbody>
</table></div>
<p>ä½¿ç”¨ä¸€ä¸ªå·²ç»æœ‰10ä¸ªkvå­—æ®µçš„loggerè®°å½•ä¸€æ¡æ¶ˆæ¯ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>åº“å</th>
<th>æ¯æ¬¡è¿­ä»£è€—æ—¶</th>
<th>è€—æ—¶ç›¸æ¯”zap</th>
<th>æ¯æ¬¡è¿­ä»£å†…å­˜åˆ†é…æ¬¡æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>âš¡ zap</td>
<td>126 ns/op</td>
<td>+0%</td>
<td>0 allocs/op</td>
</tr>
<tr>
<td>âš¡ zap (sugared)</td>
<td>187 ns/op</td>
<td>+48%</td>
<td>2 allocs/op</td>
</tr>
<tr>
<td>zerolog</td>
<td>88 ns/op</td>
<td>-30%</td>
<td>0 allocs/op</td>
</tr>
<tr>
<td>go-kit</td>
<td>5087 ns/op</td>
<td>+3937%</td>
<td>103 allocs/op</td>
</tr>
<tr>
<td>log15</td>
<td>18548 ns/op</td>
<td>+14621%</td>
<td>73 allocs/op</td>
</tr>
<tr>
<td>apex/log</td>
<td>26012 ns/op</td>
<td>+20544%</td>
<td>104 allocs/op</td>
</tr>
<tr>
<td>logrus</td>
<td>27236 ns/op</td>
<td>+21516%</td>
<td>113 allocs/op</td>
</tr>
</tbody>
</table></div>
<p>è®°å½•ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰å­—æ®µæˆ–<code>printf</code>é£æ ¼çš„æ¨¡æ¿ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>åº“å</th>
<th>æ¯æ¬¡è¿­ä»£è€—æ—¶</th>
<th>è€—æ—¶ç›¸æ¯”zap</th>
<th>æ¯æ¬¡è¿­ä»£å†…å­˜åˆ†é…æ¬¡æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td>âš¡ zap</td>
<td>118 ns/op</td>
<td>+0%</td>
<td>0 allocs/op</td>
</tr>
<tr>
<td>âš¡ zap (sugared)</td>
<td>191 ns/op</td>
<td>+62%</td>
<td>2 allocs/op</td>
</tr>
<tr>
<td>zerolog</td>
<td>93 ns/op</td>
<td>-21%</td>
<td>0 allocs/op</td>
</tr>
<tr>
<td>go-kit</td>
<td>280 ns/op</td>
<td>+137%</td>
<td>11 allocs/op</td>
</tr>
<tr>
<td>standard library</td>
<td>499 ns/op</td>
<td>+323%</td>
<td>2 allocs/op</td>
</tr>
<tr>
<td>apex/log</td>
<td>1990 ns/op</td>
<td>+1586%</td>
<td>10 allocs/op</td>
</tr>
<tr>
<td>logrus</td>
<td>3129 ns/op</td>
<td>+2552%</td>
<td>24 allocs/op</td>
</tr>
<tr>
<td>log15</td>
<td>3887 ns/op</td>
<td>+3194%</td>
<td>23 allocs/op</td>
</tr>
</tbody>
</table></div>
<h3 id="ç›¸ä¼¼çš„åº“">ç›¸ä¼¼çš„åº“</h3>
<p><a class="link" href="https://github.com/sirupsen/logrus"  target="_blank" rel="noopener"
    >logrus</a>  åŠŸèƒ½å¼ºå¤§</p>
<p><a class="link" href="https://github.com/rs/zerolog"  target="_blank" rel="noopener"
    >zerolog</a> æ€§èƒ½ç›¸å½“å¥½çš„æ—¥å¿—åº“</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E6%97%A5%E5%BF%97/">æ—¥å¿—</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="ixugo/ixugo.github.io"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
  <section class="copyright">
    &copy;
    
    2018 -
    
    2024 ixugo
  </section>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <section class="powerby">

    
    <span id="busuanzi_container_page_pv">æœ¬æ–‡é˜…è¯»é‡
      <span style="font-size: 14px" id="busuanzi_value_page_pv"></span>
      æ¬¡ï¼Œ</span>
    <span id="busuanzi_container_site_pv">æ€»è®¿é—®é‡
      <span style="font-size: 14px" id="busuanzi_value_site_pv"></span>
      æ¬¡ </span>ï¼Œæ€»è®¿å®¢æ•°
    <span style="font-size: 14px" id="busuanzi_value_site_uv"></span> äºº
    <br />


    Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> .&nbsp;&nbsp;
    Theme <a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
      data-version="3.16.0">Stack</a> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
  </section>




  <script>
    function count() {
      let href = window.location.href;
      let regexp = /^https?:\/\/blog.golang.space\/?(page\/[\d]+\/?)?$/;
      if (regexp.test(href)) {
        let e = document.getElementById("busuanzi_container_page_pv");
        e.innerText = "";
      }
    }
    window.onload = count;
  </script>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
