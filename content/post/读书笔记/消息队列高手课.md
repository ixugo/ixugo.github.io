---
title: <消息队列高手课> 读书笔记
description: 
date: 2022-06-01 
slug: 
image: 
draft: true
categories:
    - 消息队列
tags:
    - 读书笔记
---



# <消息队列高手课> 读书笔记

## 基础篇

 ### 哪些问题适合使用消息队列解决?

+ 异步任务。如秒杀，日志等。
+ 流量控制。使用消息队列隔离网关和后端服务，避免过多的请求压跨系统。
+ 服务解耦。将服务拆分，避免全部集中在订单系统，下游系统监听消息队列。

消息队列不局限于以上场景。同时，消息队列也有它的缺点和局限性。

+ 引入消息队列带来的延迟问题
+ 增加了系统的复杂度
+ 可能产生数据不一致的问题

### 该如何选择消息队列

必须具备的几个特性包括

+ 消息的可靠传递，确保不丢消息
+ 支持集群
+ 足够好的性能

可供选择的消息队列产品

+ RabbitMQ。轻量级，迅捷，开箱即用，性能比接下来介绍的要差，对消息堆积的支持并不好。
+ RocketMQ。阿里巴巴开源的产品，性能/稳定性/可靠性都值得信赖，如果你的应用场景很在意响应延迟，那应该选用 RocketMQ。
+ Kafka。最早由 LinkedIn 开发，Kafka 与周边生态系统的兼容性是最好的没有之一。一个非常成熟的消息队列产品，无论在数据可靠性、稳定性和功能特性等方面都可以满足绝大多数场景的需求。它的同步收发消息的响应时延比较高，因为当客户端发送一条消息的时候，Kafka 并不会立即发送出去，而是要等一会儿攒一批再发送，在它的 Broker 中，很多地方都会使用这种“先攒一波再一起处理”的设计。当你的业务场景中，每秒钟消息数量没有那么多的时候，Kafka 的时延反而会比较高。

| -            | kafka                | RabbitMQ | RocketMQ         | nsq  |
| ------------ | -------------------- | -------- | ---------------- | ---- |
| 推出时间     | 2012                 | 2007     | 2012             | 2013 |
| 所属         | LinkedIn 开源,Apache | Mozilla  | 阿里开源，Apache | MIT  |
| 开发语言     | Scala 和 Java        | Erlang   | Java             | Go   |
| 消费推拉模式 | Pull                 | Push     | Pull             | Push |
| 延迟队列     | N                    | Y        | Y                | Y    |
| 消息回溯     | Y                    | N        | Y                | N    |

### RocketMQ 的消息模型( Kafka 相同 )

每个主题包含多个队列，通过多个队列来实现多实例并行生产和消费。需要注意的是，RocketMQ 只在队列上保证消息的有序性，主题层面是无法保证消息的严格顺序的。

RocketMQ 中，订阅者的概念是通过消费组（Consumer Group）来体现的。每个消费组都消费主题中一份完整的消息，不同消费组之间消费进度彼此不受影响，也就是说，一条消息被 Consumer Group1 消费过，也会再给 Consumer Group2 消费。

![img](http://img.golang.space/shot-1654958804027.jpg)

在 Kafka 中，队列这个概念的名称不一样，Kafka 中对应的名称是“分区（Partition）”，含义和功能是没有任何区别的。



